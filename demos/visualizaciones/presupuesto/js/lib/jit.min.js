(function(){window.$jit=function(a){a=a||window;for(var b in $jit)$jit[b].$extend&&(a[b]=$jit[b])};$jit.version="2.0.1";var g=function(a){return document.getElementById(a)};g.empty=function(){};g.extend=function(a,b){for(var c in b||{})a[c]=b[c];return a};g.lambda=function(a){return"function"==typeof a?a:function(){return a}};g.time=Date.now||function(){return+new Date};g.splat=function(a){var b=g.type(a);return b?"array"!=b?[a]:a:[]};g.type=function(a){var b=g.type.s.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
return"object"!=b?b:a&&a.$$family?a.$$family:a&&a.nodeName&&1==a.nodeType?"element":b};g.type.s=Object.prototype.toString;g.each=function(a,b){if("object"==g.type(a))for(var c in a)b(a[c],c);else{c=0;for(var d=a.length;c<d;c++)b(a[c],c)}};g.indexOf=function(a,b){if(Array.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1};g.map=function(a,b){var c=[];g.each(a,function(a,e){c.push(b(a,e))});return c};g.reduce=function(a,b,c){var d=a.length;if(0==d)return c;for(var e=
3==arguments.length?c:a[--d];d--;)e=b(e,a[d]);return e};g.merge=function(){for(var a={},b=0,c=arguments.length;b<c;b++){var d=arguments[b];if("object"==g.type(d))for(var e in d){var f=d[e],h=a[e];a[e]=h&&"object"==g.type(f)&&"object"==g.type(h)?g.merge(h,f):g.unlink(f)}}return a};g.unlink=function(a){var b;switch(g.type(a)){case "object":b={};for(var c in a)b[c]=g.unlink(a[c]);break;case "array":b=[];c=0;for(var d=a.length;c<d;c++)b[c]=g.unlink(a[c]);break;default:return a}return b};g.zip=function(){if(0===
arguments.length)return[];for(var a=0,b=[],c=arguments.length,d=arguments[0].length;a<d;a++){for(var e=0,f=[];e<c;e++)f.push(arguments[e][a]);b.push(f)}return b};g.rgbToHex=function(a,b){if(3>a.length)return null;if(4==a.length&&0==a[3]&&!b)return"transparent";for(var c=[],d=0;3>d;d++){var e=(a[d]-0).toString(16);c.push(1==e.length?"0"+e:e)}return b?c:"#"+c.join("")};g.hexToRgb=function(a){if(7!=a.length){a=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);a.shift();if(3!=a.length)return null;for(var b=
[],c=0;3>c;c++){var d=a[c];1==d.length&&(d+=d);b.push(parseInt(d,16))}return b}a=parseInt(a.slice(1),16);return[a>>16,a>>8&255,a&255]};g.destroy=function(a){g.clean(a);a.parentNode&&a.parentNode.removeChild(a);a.clearAttributes&&a.clearAttributes()};g.clean=function(a){a=a.childNodes;for(var b=0,c=a.length;b<c;b++)g.destroy(a[b])};g.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)};g.addEvents=function(a,b){for(var c in b)g.addEvent(a,c,b[c])};g.hasClass=
function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")};g.addClass=function(a,b){g.hasClass(a,b)||(a.className=a.className+" "+b)};g.removeClass=function(a,b){a.className=a.className.replace(RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1")};g.getPos=function(a){for(var b=a,c=0,d=0;b&&!/^(?:body|html)$/i.test(b.tagName);)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;for(var e=b=0;a&&!/^(?:body|html)$/i.test(a.tagName);)b+=a.scrollLeft,e+=a.scrollTop,a=a.parentNode;return{x:c-b,y:d-e}};g.event={get:function(a,
b){b=b||window;return a||b.event},getWheel:function(a){return a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3},isRightClick:function(a){return 3==a.which||2==a.button},getPos:function(a,b){b=b||window;a=a||b.event;var c=b.document,c=c.documentElement||c.body;a.touches&&a.touches.length&&(a=a.touches[0]);return{x:a.pageX||a.clientX+c.scrollLeft,y:a.pageY||a.clientY+c.scrollTop}},stop:function(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=
!1}};$jit.util=$jit.id=g;var j=function(a){a=a||{};var b=function(){for(var a in this)"function"!=typeof this[a]&&(this[a]=g.unlink(this[a]));this.constructor=b;if(j.prototyping)return this;a=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return a},c;for(c in j.Mutators)a[c]&&(a=j.Mutators[c](a,a[c]),delete a[c]);g.extend(b,this);b.constructor=j;b.prototype=a;return b};j.Mutators={Implements:function(a,b){g.each(g.splat(b),function(b){j.prototyping=b;b="function"==
typeof b?new b:b;for(var d in b)d in a||(a[d]=b[d]);delete j.prototyping});return a}};g.extend(j,{inherit:function(a,b){for(var c in b){var d=b[c],e=a[c],f=g.type(d);e&&"function"==f?d!=e&&j.override(a,c,d):a[c]="object"==f?g.merge(e,d):d}return a},override:function(a,b,c){var d=j.prototyping;d&&a[b]!=d[b]&&(d=null);a[b]=function(){var e=this.parent;this.parent=d?d[b]:a[b];var f=c.apply(this,arguments);this.parent=e;return f}}});j.prototype.implement=function(){var a=this.prototype;g.each(Array.prototype.slice.call(arguments||
[]),function(b){j.inherit(a,b)});return this};$jit.Class=j;$jit.json={prune:function(a,b){this.each(a,function(a,d){d==b&&a.children&&(delete a.children,a.children=[])})},getParent:function(a,b){if(a.id==b)return!1;var c=a.children;if(c&&0<c.length)for(var d=0;d<c.length;d++){if(c[d].id==b)return a;var e=this.getParent(c[d],b);if(e)return e}return!1},getSubtree:function(a,b){if(a.id==b)return a;for(var c=0,d=a.children;d&&c<d.length;c++){var e=this.getSubtree(d[c],b);if(null!=e)return e}return null},
eachLevel:function(a,b,c,d){if(b<=c&&(d(a,b),a.children)){var e=0;for(a=a.children;e<a.length;e++)this.eachLevel(a[e],b+1,c,d)}},each:function(a,b){this.eachLevel(a,0,Number.MAX_VALUE,b)}};$jit.Trans={$extend:!0,linear:function(a){return a}};var L=$jit.Trans,$=function(a,b){b=g.splat(b);return g.extend(a,{easeIn:function(c){return a(c,b)},easeOut:function(c){return 1-a(1-c,b)},easeInOut:function(c){return 0.5>=c?a(2*c,b)/2:(2-a(2*(1-c),b))/2}})};g.each({Pow:function(a,b){return Math.pow(a,b[0]||6)},
Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a,b){b=b[0]||1.618;return Math.pow(a,2)*((b+1)*a-b)},Bounce:function(a){for(var b,c=0,d=1;;c+=d,d/=2)if(a>=(7-4*c)/11){b=d*d-Math.pow((11-6*c-11*a)/4,2);break}return b},Elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b[0]||1)/3)}},function(a,b){L[b]=$(a)});g.each(["Quad","Cubic","Quart","Quint"],function(a,b){L[a]=
$(function(a){return Math.pow(a,[b+2])})});var P=new j({initialize:function(a){this.setOptions(a)},setOptions:function(a){this.opt=g.merge({duration:2500,fps:40,transition:L.Quart.easeInOut,compute:g.empty,complete:g.empty,link:"ignore"},a||{});return this},step:function(){var a=g.time(),b=this.opt;a<this.time+b.duration?(a=b.transition((a-this.time)/b.duration),b.compute(a)):(this.timer=clearInterval(this.timer),b.compute(1),b.complete())},start:function(){if(!this.check())return this;this.time=
0;this.startTimer();return this},startTimer:function(){var a=this,b=this.opt.fps;if(this.timer)return!1;this.time=g.time()-this.time;this.timer=setInterval(function(){a.step()},Math.round(1E3/b));return!0},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer)return!1;this.time=g.time()-this.time;this.timer=clearInterval(this.timer);return!0},check:function(){return!this.timer?!0:"cancel"==this.opt.link?(this.stopTimer(),
!0):!1}}),v=function(){for(var a=arguments,b=0,c=a.length,d={};b<c;b++){var e=v[a[b]];e.$extend?g.extend(d,e):d[a[b]]=e}return d};v.AreaChart={$extend:!0,animate:!0,labelOffset:3,type:"stacked",Tips:{enable:!1,onShow:g.empty,onHide:g.empty},Events:{enable:!1,onClick:g.empty},selectOnHover:!0,showAggregates:!0,showLabels:!0,filterOnClick:!1,restoreOnRightClick:!1};v.Margin={$extend:!1,top:0,left:0,right:0,bottom:0};v.Canvas={$extend:!0,injectInto:"id",type:"2D",width:!1,height:!1,useCanvas:!1,withLabels:!0,
background:!1,Scene:{Lighting:{enable:!1,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[0.5,0.3,0.1]}}}};v.Tree={$extend:!0,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:!1,align:"center"};v.Node={$extend:!1,overridable:!1,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:!1,autoWidth:!1,lineWidth:1,transform:!0,align:"center",angularWidth:1,span:1,CanvasStyles:{}};v.Edge={$extend:!1,overridable:!1,type:"line",color:"#ccb",lineWidth:1,
dim:15,alpha:1,epsilon:7,CanvasStyles:{}};v.Fx={$extend:!0,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:!0};v.Label={$extend:!1,overridable:!1,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};v.Tips={$extend:!1,enable:!1,type:"auto",offsetX:20,offsetY:20,force:!1,onShow:g.empty,onHide:g.empty};v.NodeStyles={$extend:!1,enable:!1,type:"auto",stylesHover:!1,stylesClick:!1};v.Events={$extend:!1,enable:!1,enableForEdges:!1,
type:"auto",onClick:g.empty,onRightClick:g.empty,onMouseMove:g.empty,onMouseEnter:g.empty,onMouseLeave:g.empty,onDragStart:g.empty,onDragMove:g.empty,onDragCancel:g.empty,onDragEnd:g.empty,onTouchStart:g.empty,onTouchMove:g.empty,onTouchEnd:g.empty,onMouseWheel:g.empty};v.Navigation={$extend:!1,enable:!1,type:"auto",panning:!1,zooming:!1};v.Controller={$extend:!0,onBeforeCompute:g.empty,onAfterCompute:g.empty,onCreateLabel:g.empty,onPlaceLabel:g.empty,onComplete:g.empty,onBeforePlotLine:g.empty,onAfterPlotLine:g.empty,
onBeforePlotNode:g.empty,onAfterPlotNode:g.empty,request:!1};var x={initialize:function(a,b){this.viz=b;this.canvas=b.canvas;this.config=b.config[a];this.nodeTypes=b.fx.nodeTypes;var c=this.config.type;this.labelContainer=(this.dom="auto"==c?"Native"!=b.config.Label.type:"Native"!=c)&&b.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:g.empty,setAsProperty:g.lambda(!1),isEnabled:function(){return this.config.enable},isLabel:function(a,b,c){a=g.event.get(a,b);b=this.labelContainer;
var d=a.target||a.srcElement;a=a.relatedTarget;return c?a&&a==this.viz.canvas.getCtx().canvas&&!!d&&this.isDescendantOf(d,b):this.isDescendantOf(d,b)},isDescendantOf:function(a,b){for(;a&&a.parentNode;){if(a.parentNode==b)return a;a=a.parentNode}return!1}},y={onMouseUp:g.empty,onMouseDown:g.empty,onMouseMove:g.empty,onMouseOver:g.empty,onMouseOut:g.empty,onMouseWheel:g.empty,onTouchStart:g.empty,onTouchMove:g.empty,onTouchEnd:g.empty,onTouchCancel:g.empty},ha=new j({initialize:function(a){this.viz=
a;this.canvas=a.canvas;this.edge=this.node=!1;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var a=this.canvas.getElement(),b=this;a.oncontextmenu=g.lambda(!1);g.addEvents(a,{mouseup:function(a,c){var f=g.event.get(a,c);b.handleEvent("MouseUp",a,c,b.makeEventObject(a,c),g.event.isRightClick(f))},mousedown:function(a,c){var f=g.event.get(a,c);b.handleEvent("MouseDown",a,c,b.makeEventObject(a,c),g.event.isRightClick(f))},mousemove:function(a,c){b.handleEvent("MouseMove",a,c,
b.makeEventObject(a,c))},mouseover:function(a,c){b.handleEvent("MouseOver",a,c,b.makeEventObject(a,c))},mouseout:function(a,c){b.handleEvent("MouseOut",a,c,b.makeEventObject(a,c))},touchstart:function(a,c){b.handleEvent("TouchStart",a,c,b.makeEventObject(a,c))},touchmove:function(a,c){b.handleEvent("TouchMove",a,c,b.makeEventObject(a,c))},touchend:function(a,c){b.handleEvent("TouchEnd",a,c,b.makeEventObject(a,c))}});var c=function(a,c){var f=g.event.get(a,c),f=g.event.getWheel(f);b.handleEvent("MouseWheel",
a,c,f)};!document.getBoxObjectFor&&null==window.mozInnerScreenX?g.addEvent(a,"mousewheel",c):a.addEventListener("DOMMouseScroll",c,!1)},register:function(a){this.registeredObjects.push(a)},handleEvent:function(){for(var a=Array.prototype.slice.call(arguments),b=a.shift(),c=0,d=this.registeredObjects,e=d.length;c<e;c++)d[c]["on"+b].apply(d[c],a)},makeEventObject:function(a,b){var c=this,d=this.viz.graph,e=this.viz.fx,f=e.nodeTypes,h=e.edgeTypes;return{pos:!1,node:!1,edge:!1,contains:!1,getNodeCalled:!1,
getEdgeCalled:!1,getPos:function(){var d=c.viz.canvas,e=d.getSize(),f=d.getPos(),h=d.translateOffsetX,s=d.translateOffsetY,p=d.scaleOffsetX,d=d.scaleOffsetY,I=g.event.getPos(a,b);return this.pos={x:1*(I.x-f.x-e.width/2-h)/p,y:1*(I.y-f.y-e.height/2-s)/d}},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=!0;for(var a in d.nodes){var b=d.nodes[a],h=b&&f[b.getData("type")];if(h=h&&h.contains&&h.contains.call(e,b,this.getPos()))return this.contains=h,c.node=this.node=b}return c.node=
this.node=!1},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=!0;var a={},b;for(b in d.edges){var f=d.edges[b];a[b]=!0;for(var g in f)if(!(g in a)){var s=f[g],p=s&&h[s.getData("type")];if(p=p&&p.contains&&p.contains.call(e,s,this.getPos()))return this.contains=p,c.edge=this.edge=s}}return c.edge=this.edge=!1},getContains:function(){if(this.getNodeCalled)return this.contains;this.getNode();return this.contains}}}}),H={initializeExtras:function(){var a=new ha(this),b=this;
g.each(["NodeStyles","Tips","Navigation","Events"],function(c){var d=new H.Classes[c](c,b);d.isEnabled()&&a.register(d);d.setAsProperty()&&(b[c.toLowerCase()]=d)})},Classes:{}};H.Classes.Events=new j({Implements:[x,y],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.moved=this.touchMoved=this.touched=this.pressed=this.hovered=!1},setAsProperty:g.lambda(!0),onMouseUp:function(a,b,c,d){a=g.event.get(a,b);if(!this.moved)if(d)this.config.onRightClick(this.hovered,
c,a);else this.config.onClick(this.pressed,c,a);if(this.pressed){if(this.moved)this.config.onDragEnd(this.pressed,c,a);else this.config.onDragCancel(this.pressed,c,a);this.pressed=this.moved=!1}},onMouseOut:function(a,b,c){var d=g.event.get(a,b),e;if(this.dom&&(e=this.isLabel(a,b,!0)))this.config.onMouseLeave(this.viz.graph.getNode(e.id),c,d),this.hovered=!1;else{a=d.relatedTarget;for(b=this.canvas.getElement();a&&a.parentNode;){if(b==a.parentNode)return;a=a.parentNode}this.hovered&&(this.config.onMouseLeave(this.hovered,
c,d),this.hovered=!1)}},onMouseOver:function(a,b,c){var d=g.event.get(a,b),e;if(this.dom&&(e=this.isLabel(a,b,!0)))this.hovered=this.viz.graph.getNode(e.id),this.config.onMouseEnter(this.hovered,c,d)},onMouseMove:function(a,b,c){a=g.event.get(a,b);if(this.pressed)this.moved=!0,this.config.onDragMove(this.pressed,c,a);else if(this.dom)this.config.onMouseMove(this.hovered,c,a);else{if(this.hovered){b=this.hovered;var d=b.nodeFrom?this.etypes[b.getData("type")]:this.ntypes[b.getData("type")];if(d&&d.contains&&
d.contains.call(this.fx,b,c.getPos())){this.config.onMouseMove(b,c,a);return}this.config.onMouseLeave(b,c,a);this.hovered=!1}if(this.hovered=c.getNode()||this.config.enableForEdges&&c.getEdge())this.config.onMouseEnter(this.hovered,c,a);else this.config.onMouseMove(!1,c,a)}},onMouseWheel:function(a,b,c){this.config.onMouseWheel(c,g.event.get(a,b))},onMouseDown:function(a,b,c){var d=g.event.get(a,b);if(this.dom){if(a=this.isLabel(a,b))this.pressed=this.viz.graph.getNode(a.id)}else this.pressed=c.getNode()||
this.config.enableForEdges&&c.getEdge();this.pressed&&this.config.onDragStart(this.pressed,c,d)},onTouchStart:function(a,b,c){var d=g.event.get(a,b),e;(this.touched=this.dom&&(e=this.isLabel(a,b))?this.viz.graph.getNode(e.id):c.getNode()||this.config.enableForEdges&&c.getEdge())&&this.config.onTouchStart(this.touched,c,d)},onTouchMove:function(a,b,c){a=g.event.get(a,b);this.touched&&(this.touchMoved=!0,this.config.onTouchMove(this.touched,c,a))},onTouchEnd:function(a,b,c){a=g.event.get(a,b);if(this.touched){if(this.touchMoved)this.config.onTouchEnd(this.touched,
c,a);else this.config.onTouchCancel(this.touched,c,a);this.touched=this.touchMoved=!1}}});H.Classes.Tips=new j({Implements:[x,y],initializePost:function(){if(document.body){var a=g("_tooltip")||document.createElement("div");a.id="_tooltip";a.className="tip";g.extend(a.style,{position:"absolute",display:"none",zIndex:13E3});document.body.appendChild(a);this.tip=a;this.node=!1}},setAsProperty:g.lambda(!0),onMouseOut:function(a,b){g.event.get(a,b);if(this.dom&&this.isLabel(a,b,!0))this.hide(!0);else{for(var c=
a.relatedTarget,d=this.canvas.getElement();c&&c.parentNode;){if(d==c.parentNode)return;c=c.parentNode}this.hide(!1)}},onMouseOver:function(a,b){var c;if(this.dom&&(c=this.isLabel(a,b,!1)))this.node=this.viz.graph.getNode(c.id),this.config.onShow(this.tip,this.node,c)},onMouseMove:function(a,b,c){this.dom&&this.isLabel(a,b)&&this.setTooltipPosition(g.event.getPos(a,b));if(!this.dom){var d=c.getNode();if(d){if(this.config.force||!this.node||this.node.id!=d.id)this.node=d,this.config.onShow(this.tip,
d,c.getContains());this.setTooltipPosition(g.event.getPos(a,b))}else this.hide(!0)}},setTooltipPosition:function(a){var b=this.tip,c=b.style,d=this.config;c.display="";var e=document.body.clientWidth,f=b.offsetWidth,b=b.offsetHeight,h=d.offsetX,d=d.offsetY;c.top=(a.y+d+b>document.body.clientHeight?a.y-b-d:a.y+d)+"px";c.left=(a.x+f+h>e?a.x-f-h:a.x+h)+"px"},hide:function(a){this.tip.style.display="none";a&&this.config.onHide()}});H.Classes.NodeStyles=new j({Implements:[x,y],initializePost:function(){this.fx=
this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=!1;this.fx.nodeFxAnimation=new P;this.move=this.down=!1},onMouseOut:function(a,b){this.down=this.move=!1;if(this.hoveredNode){this.dom&&this.isLabel(a,b,!0)&&this.toggleStylesOnHover(this.hoveredNode,!1);for(var c=a.relatedTarget,d=this.canvas.getElement();c&&c.parentNode;){if(d==c.parentNode)return;c=c.parentNode}this.toggleStylesOnHover(this.hoveredNode,
!1);this.hoveredNode=!1}},onMouseOver:function(a,b){var c;if(this.dom&&(c=this.isLabel(a,b,!0)))c=this.viz.graph.getNode(c.id),c.selected||(this.hoveredNode=c,this.toggleStylesOnHover(this.hoveredNode,!0))},onMouseDown:function(a,b,c,d){if(!d){var e;this.dom&&(e=this.isLabel(a,b))?this.down=this.viz.graph.getNode(e.id):this.dom||(this.down=c.getNode());this.move=!1}},onMouseUp:function(a,b,c,d){if(!d){if(!this.move)this.onClick(c.getNode());this.down=this.move=!1}},getRestoredStyles:function(a,b){var c=
{},d=this["nodeStylesOn"+b],e;for(e in d)c[e]=a.styles["$"+e];return c},toggleStylesOnHover:function(a,b){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",a,b)},toggleStylesOnClick:function(a,b){this.nodeStylesOnClick&&this.toggleStylesOn("Click",a,b)},toggleStylesOn:function(a,b,c){var d=this.viz;if(c){b.styles||(b.styles=g.merge(b.data,{}));for(var e in this["nodeStylesOn"+a])c="$"+e,c in b.styles||(b.styles[c]=b.getData(e));d.fx.nodeFx(g.extend({elements:{id:b.id,properties:this["nodeStylesOn"+
a]},transition:L.Quart.easeOut,duration:300,fps:40},this.config))}else a=this.getRestoredStyles(b,a),d.fx.nodeFx(g.extend({elements:{id:b.id,properties:a},transition:L.Quart.easeOut,duration:300,fps:40},this.config))},onClick:function(a){if(a){var b=this.nodeStylesOnClick;b&&(a.selected?(this.toggleStylesOnClick(a,!1),delete a.selected):(this.viz.graph.eachNode(function(a){if(a.selected){for(var d in b)a.setData(d,a.styles["$"+d],"end");delete a.selected}}),this.toggleStylesOnClick(a,!0),a.selected=
!0,delete a.hovered,this.hoveredNode=!1))}},onMouseMove:function(a,b,c){this.down&&(this.move=!0);if(!this.dom||!this.isLabel(a,b)){var d=this.nodeStylesOnHover;if(d&&!this.dom){if(this.hoveredNode&&(a=this.types[this.hoveredNode.getData("type")])&&a.contains&&a.contains.call(this.fx,this.hoveredNode,c.getPos()))return;c=c.getNode();if((this.hoveredNode||c)&&!c.hovered)c&&!c.selected?(this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(a){if(a.hovered&&!a.selected){for(var b in d)a.setData(b,
a.styles["$"+b],"end");delete a.hovered}}),c.hovered=!0,this.hoveredNode=c,this.toggleStylesOnHover(c,!0)):this.hoveredNode&&!this.hoveredNode.selected&&(this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,!1),delete this.hoveredNode.hovered,this.hoveredNode=!1)}}}});H.Classes.Navigation=new j({Implements:[x,y],initializePost:function(){this.pressed=this.pos=!1},onMouseWheel:function(a,b,c){this.config.zooming&&(g.event.stop(g.event.get(a,b)),a=1+c*(this.config.zooming/1E3),
this.canvas.scale(a,a))},onMouseDown:function(a,b,c){if(this.config.panning&&!("avoid nodes"==this.config.panning&&(this.dom?this.isLabel(a,b):c.getNode()))){this.pressed=!0;this.pos=c.getPos();a=this.canvas;b=a.translateOffsetX;c=a.translateOffsetY;var d=a.scaleOffsetY;this.pos.x*=a.scaleOffsetX;this.pos.x+=b;this.pos.y*=d;this.pos.y+=c}},onMouseMove:function(a,b,c){if(this.config.panning&&this.pressed&&!("avoid nodes"==this.config.panning&&(this.dom?this.isLabel(a,b):c.getNode()))){a=this.pos;c=
c.getPos();var d=this.canvas,e=d.translateOffsetX,f=d.translateOffsetY;b=d.scaleOffsetX;d=d.scaleOffsetY;c.x*=b;c.y*=d;c.x+=e;c.y+=f;e=c.x-a.x;a=c.y-a.y;this.pos=c;this.canvas.translate(1*e/b,1*a/d)}},onMouseUp:function(){this.config.panning&&(this.pressed=!1)}});var G,S=function(a,b){var c=document.createElement(a),d;for(d in b)"object"==typeof b[d]?g.extend(c[d],b[d]):c[d]=b[d];"canvas"==a&&(!aa&&G_vmlCanvasManager)&&(c=G_vmlCanvasManager.initElement(document.body.appendChild(c)));return c},x=typeof HTMLCanvasElement,
aa="object"==x||"function"==x;$jit.Canvas=G=new j({canvases:[],pos:!1,element:!1,labelContainer:!1,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(a,b){this.viz=a;this.opt=this.config=b;var c="string"==g.type(b.injectInto)?b.injectInto:b.injectInto.id,d=b.type,e=c+"-label",f=g(c),h=b.width||f.offsetWidth,m=b.height||f.offsetHeight;this.id=c;var n={injectInto:c,width:h,height:m};this.element=S("div",{id:c+"-canvaswidget",style:{position:"relative",width:h+"px",
height:m+"px"}});this.labelContainer=this.createLabelContainer(b.Label.type,e,n);this.canvases.push(new G.Base[d]({config:g.extend({idSuffix:"-canvas"},n),plot:function(){a.fx.plot()},resize:function(){a.refresh()}}));if(c=b.background)n=new G.Background[c.type](a,g.extend(c,n)),this.canvases.push(new G.Base[d](n));for(d=this.canvases.length;d--;)this.element.appendChild(this.canvases[d].canvas),0<d&&this.canvases[d].plot();this.element.appendChild(this.labelContainer);f.appendChild(this.element);
var l=null,q=this;g.addEvent(window,"scroll",function(){clearTimeout(l);l=setTimeout(function(){q.getPos(!0)},500)})},getCtx:function(a){return this.canvases[a||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(a){return this.canvases[a||0].getSize()},resize:function(a,b){this.getPos(!0);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var c=0,d=this.canvases.length;c<d;c++)this.canvases[c].resize(a,
b);c=this.element.style;c.width=a+"px";c.height=b+"px";this.labelContainer&&(this.labelContainer.style.width=a+"px")},translate:function(a,b,c){this.translateOffsetX+=a*this.scaleOffsetX;this.translateOffsetY+=b*this.scaleOffsetY;for(var d=0,e=this.canvases.length;d<e;d++)this.canvases[d].translate(a,b,c)},scale:function(a,b){var c=this.scaleOffsetX*a,d=this.scaleOffsetY*b,e=this.translateOffsetX*(a-1)/c,f=this.translateOffsetY*(b-1)/d;this.scaleOffsetX=c;this.scaleOffsetY=d;c=0;for(d=this.canvases.length;c<
d;c++)this.canvases[c].scale(a,b,!0);this.translate(e,f,!1)},getPos:function(a){return a||!this.pos?this.pos=g.getPos(this.getElement()):this.pos},clear:function(a){this.canvases[a||0].clear()},path:function(a,b){var c=this.canvases[0].getCtx();c.beginPath();b(c);c[a]();c.closePath()},createLabelContainer:function(a,b,c){if("HTML"==a||"Native"==a)return S("div",{id:b,style:{overflow:"visible",position:"absolute",top:0,left:0,width:c.width+"px",height:0}});if("SVG"==a){a=document.createElementNS("http://www.w3.org/2000/svg",
"svg:svg");a.setAttribute("width",c.width);a.setAttribute("height",c.height);var d=a.style;d.position="absolute";d.left=d.top="0px";d=document.createElementNS("http://www.w3.org/2000/svg","svg:g");d.setAttribute("width",c.width);d.setAttribute("height",c.height);d.setAttribute("x",0);d.setAttribute("y",0);d.setAttribute("id",b);a.appendChild(d);return a}}});G.Base={};G.Base["2D"]=new j({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(a){this.viz=a;this.opt=
a.config;this.size=!1;this.createCanvas();this.translateToCenter()},createCanvas:function(){var a=this.opt,b=a.width,c=a.height;this.canvas=S("canvas",{id:a.injectInto+a.idSuffix,width:b,height:c,style:{position:"absolute",top:0,left:0,width:b+"px",height:c+"px"}})},getCtx:function(){return!this.ctx?this.ctx=this.canvas.getContext("2d"):this.ctx},getSize:function(){if(this.size)return this.size;var a=this.canvas;return this.size={width:a.width,height:a.height}},translateToCenter:function(a){var b=
this.getSize(),c=a?b.width-a.width-2*this.translateOffsetX:b.width;height=a?b.height-a.height-2*this.translateOffsetY:b.height;b=this.getCtx();a&&b.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);b.translate(c/2,height/2)},resize:function(a,b){var c=this.getSize(),d=this.canvas,e=d.style;this.size=!1;d.width=a;d.height=b;e.width=a+"px";e.height=b+"px";aa?this.translateToCenter():this.translateToCenter(c);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();
this.viz.resize(a,b,this)},translate:function(a,b,c){var d=this.scaleOffsetY;this.translateOffsetX+=a*this.scaleOffsetX;this.translateOffsetY+=b*d;this.getCtx().translate(a,b);!c&&this.plot()},scale:function(a,b,c){this.scaleOffsetX*=a;this.scaleOffsetY*=b;this.getCtx().scale(a,b);!c&&this.plot()},clear:function(){var a=this.getSize(),b=this.translateOffsetX,c=this.translateOffsetY,d=this.scaleOffsetX,e=this.scaleOffsetY;this.getCtx().clearRect(1*(-a.width/2-b)/d,1*(-a.height/2-c)/e,1*a.width/d,1*
a.height/e)},plot:function(){this.clear();this.viz.plot(this)}});G.Background={};G.Background.Circles=new j({initialize:function(a,b){this.viz=a;this.config=g.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},b)},resize:function(a,b,c){this.plot(c)},plot:function(a){a=a.getCtx();var b=this.config,c=b.CanvasStyles,d;for(d in c)a[d]=c[d];d=b.numberOfCircles;b=b.levelDistance;for(c=1;c<=d;c++)a.beginPath(),a.arc(0,0,b*c,0,2*Math.PI,!1),a.stroke(),a.closePath()}});
var E=function(a,b){this.theta=a||0;this.rho=b||0};$jit.Polar=E;E.prototype={getc:function(a){return this.toComplex(a)},getp:function(){return this},set:function(a){a=a.getp();this.theta=a.theta;this.rho=a.rho},setc:function(a,b){this.rho=Math.sqrt(a*a+b*b);this.theta=Math.atan2(b,a);0>this.theta&&(this.theta+=2*Math.PI)},setp:function(a,b){this.theta=a;this.rho=b},clone:function(){return new E(this.theta,this.rho)},toComplex:function(a){var b=Math.cos(this.theta)*this.rho,c=Math.sin(this.theta)*
this.rho;return a?{x:b,y:c}:new z(b,c)},add:function(a){return new E(this.theta+a.theta,this.rho+a.rho)},scale:function(a){return new E(this.theta,this.rho*a)},equals:function(a){return this.theta==a.theta&&this.rho==a.rho},$add:function(a){this.theta+=a.theta;this.rho+=a.rho;return this},$madd:function(a){this.theta=(this.theta+a.theta)%(2*Math.PI);this.rho+=a.rho;return this},$scale:function(a){this.rho*=a;return this},isZero:function(){var a=Math.abs;return 1E-4>a(this.theta)&&1E-4>a(this.rho)},
interpolate:function(a,b){var c=Math.PI,d=2*c,e=function(a){return 0>a?a%d+d:a%d},f=this.theta,h=a.theta,m=Math.abs(f-h);return{theta:m==c?f>h?e(h+(f-d-h)*b):e(h-d+(f-h)*b):m>=c?f>h?e(h+(f-d-h)*b):e(h-d+(f-(h-d))*b):e(h+(f-h)*b),rho:(this.rho-a.rho)*b+a.rho}}};E.KER=new E(0,0);var z=function(a,b){this.x=a||0;this.y=b||0};$jit.Complex=z;z.prototype={getc:function(){return this},getp:function(a){return this.toPolar(a)},set:function(a){a=a.getc(!0);this.x=a.x;this.y=a.y},setc:function(a,b){this.x=a;
this.y=b},setp:function(a,b){this.x=Math.cos(a)*b;this.y=Math.sin(a)*b},clone:function(){return new z(this.x,this.y)},toPolar:function(a){var b=this.norm(),c=Math.atan2(this.y,this.x);0>c&&(c+=2*Math.PI);return a?{theta:c,rho:b}:new E(c,b)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(a){return new z(this.x+a.x,this.y+a.y)},prod:function(a){return new z(this.x*a.x-this.y*a.y,this.y*a.x+this.x*a.y)},conjugate:function(){return new z(this.x,
-this.y)},scale:function(a){return new z(this.x*a,this.y*a)},equals:function(a){return this.x==a.x&&this.y==a.y},$add:function(a){this.x+=a.x;this.y+=a.y;return this},$prod:function(a){var b=this.x,c=this.y;this.x=b*a.x-c*a.y;this.y=c*a.x+b*a.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(a){this.x*=a;this.y*=a;return this},$div:function(a){var b=this.x,c=this.y,d=a.squaredNorm();this.x=b*a.x+c*a.y;this.y=c*a.x-b*a.y;return this.$scale(1/d)},isZero:function(){var a=
Math.abs;return 1E-4>a(this.x)&&1E-4>a(this.y)}};var J=function(a,b){return new z(a,b)};z.KER=J(0,0);$jit.Graph=new j({initialize:function(a,b,c,d){var e={klass:z,Node:{}};this.Node=b;this.Edge=c;this.Label=d;this.opt=g.merge(e,a||{});this.nodes={};this.edges={};var f=this;this.nodeList={};for(var h in Q)f.nodeList[h]=function(a){return function(){var b=Array.prototype.slice.call(arguments);f.eachNode(function(c){c[a].apply(c,b)})}}(h)},getNode:function(a){return this.hasNode(a)?this.nodes[a]:!1},
get:function(a){return this.getNode(a)},getByName:function(a){for(var b in this.nodes){var c=this.nodes[b];if(c.name==a)return c}return!1},getAdjacence:function(a,b){return a in this.edges?this.edges[a][b]:!1},addNode:function(a){if(!this.nodes[a.id]){var b=this.edges[a.id]={};this.nodes[a.id]=new k.Node(g.extend({id:a.id,name:a.name,data:g.merge(a.data||{},{}),adjacencies:b},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[a.id]},addAdjacence:function(a,b,c){this.hasNode(a.id)||
this.addNode(a);this.hasNode(b.id)||this.addNode(b);a=this.nodes[a.id];b=this.nodes[b.id];if(!a.adjacentTo(b)){var d=this.edges[a.id]=this.edges[a.id]||{},e=this.edges[b.id]=this.edges[b.id]||{};d[b.id]=e[a.id]=new k.Adjacence(a,b,c,this.Edge,this.Label);return d[b.id]}return this.edges[a.id][b.id]},removeNode:function(a){if(this.hasNode(a)){delete this.nodes[a];var b=this.edges[a],c;for(c in b)delete this.edges[c][a];delete this.edges[a]}},removeAdjacence:function(a,b){delete this.edges[a][b];delete this.edges[b][a]},
hasNode:function(a){return a in this.nodes},empty:function(){this.nodes={};this.edges={}}});var k=$jit.Graph,Q,T=function(a,b,c,d,e){var f;c=c||"current";"current"==c?f=this.data:"start"==c?f=this.startData:"end"==c&&(f=this.endData);a="$"+(a?a+"-":"")+b;return d?f[a]:!this.Config.overridable?e[b]||0:a in f?f[a]:a in this.data?this.data[a]:e[b]||0},U=function(a,b,c,d){d=d||"current";var e;"current"==d?e=this.data:"start"==d?e=this.startData:"end"==d&&(e=this.endData);e["$"+(a?a+"-":"")+b]=c},V=function(a,
b){a="$"+(a?a+"-":"");var c=this;g.each(b,function(b){b=a+b;delete c.data[b];delete c.endData[b];delete c.startData[b]})};Q={getData:function(a,b,c){return T.call(this,"",a,b,c,this.Config)},setData:function(a,b,c){U.call(this,"",a,b,c)},setDataset:function(a,b){a=g.splat(a);for(var c in b)for(var d=0,e=g.splat(b[c]),f=a.length;d<f;d++)this.setData(c,e[d],a[d])},removeData:function(){V.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(a,b,c){return T.call(this,"canvas",
a,b,c,this.Config.CanvasStyles)},setCanvasStyle:function(a,b,c){U.call(this,"canvas",a,b,c)},setCanvasStyles:function(a,b){a=g.splat(a);for(var c in b)for(var d=0,e=g.splat(b[c]),f=a.length;d<f;d++)this.setCanvasStyle(c,e[d],a[d])},removeCanvasStyle:function(){V.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(a,b,c){return T.call(this,"label",a,b,c,this.Label)},setLabelData:function(a,b,c){U.call(this,"label",a,b,c)},setLabelDataset:function(a,b){a=g.splat(a);for(var c in b)for(var d=
0,e=g.splat(b[c]),f=a.length;d<f;d++)this.setLabelData(c,e[d],a[d])},removeLabelData:function(){V.call(this,"label",Array.prototype.slice.call(arguments))}};k.Node=new j({initialize:function(a,b,c,d,e){b={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},pos:new b,startPos:new b,endPos:new b};g.extend(this,g.extend(b,a));this.Config=this.Node=c;this.Edge=d;this.Label=e},adjacentTo:function(a){return a.id in this.adjacencies},getAdjacency:function(a){return this.adjacencies[a]},
getPos:function(a){a=a||"current";if("current"==a)return this.pos;if("end"==a)return this.endPos;if("start"==a)return this.startPos},setPos:function(a,b){b=b||"current";var c;"current"==b?c=this.pos:"end"==b?c=this.endPos:"start"==b&&(c=this.startPos);c.set(a)}});k.Node.implement(Q);k.Adjacence=new j({initialize:function(a,b,c,d,e){this.nodeFrom=a;this.nodeTo=b;this.data=c||{};this.startData={};this.endData={};this.Config=this.Edge=d;this.Label=e}});k.Adjacence.implement(Q);k.Util={filter:function(a){if(!a||
"string"!=g.type(a))return function(){return!0};var b=a.split(" ");return function(a){for(var d=0;d<b.length;d++)if(a[b[d]])return!1;return!0}},getNode:function(a,b){return a.nodes[b]},eachNode:function(a,b,c){c=this.filter(c);for(var d in a.nodes)c(a.nodes[d])&&b(a.nodes[d])},each:function(a,b,c){this.eachNode(a,b,c)},eachAdjacency:function(a,b,c){var d=a.adjacencies;c=this.filter(c);for(var e in d){var f=d[e];if(c(f)){if(f.nodeFrom!=a){var h=f.nodeFrom;f.nodeFrom=f.nodeTo;f.nodeTo=h}b(f,e)}}},computeLevels:function(a,
b,c,d){c=c||0;var e=this.filter(d);this.eachNode(a,function(a){a._flag=!1;a._depth=-1},d);a=a.getNode(b);a._depth=c;for(var f=[a];0!=f.length;){var h=f.pop();h._flag=!0;this.eachAdjacency(h,function(a){a=a.nodeTo;!1==a._flag&&e(a)&&(0>a._depth&&(a._depth=h._depth+1+c),f.unshift(a))},d)}},eachBFS:function(a,b,c,d){var e=this.filter(d);this.clean(a);for(var f=[a.getNode(b)];0!=f.length;)a=f.pop(),a._flag=!0,c(a,a._depth),this.eachAdjacency(a,function(a){a=a.nodeTo;!1==a._flag&&e(a)&&(a._flag=!0,f.unshift(a))},
d)},eachLevel:function(a,b,c,d,e){var f=a._depth,h=this.filter(e),m=this;c=!1===c?Number.MAX_VALUE-f:c;(function l(a,b,c){var e=a._depth;e>=b&&(e<=c&&h(a))&&d(a,e);e<c&&m.eachAdjacency(a,function(a){a=a.nodeTo;a._depth>e&&l(a,b,c)})})(a,b+f,c+f)},eachSubgraph:function(a,b,c){this.eachLevel(a,0,!1,b,c)},eachSubnode:function(a,b,c){this.eachLevel(a,1,1,b,c)},anySubnode:function(a,b,c){var d=!1;b=b||g.lambda(!0);var e="string"==g.type(b)?function(a){return a[b]}:b;this.eachSubnode(a,function(a){e(a)&&
(d=!0)},c);return d},getSubnodes:function(a,b,c){var d=[];b=b||0;var e;"array"==g.type(b)?(e=b[0],b=b[1]):(e=b,b=Number.MAX_VALUE-a._depth);this.eachLevel(a,e,b,function(a){d.push(a)},c);return d},getParents:function(a){var b=[];this.eachAdjacency(a,function(c){c=c.nodeTo;c._depth<a._depth&&b.push(c)});return b},isDescendantOf:function(a,b){if(a.id==b)return!0;for(var c=this.getParents(a),d=!1,e=0;!d&&e<c.length;e++)d=d||this.isDescendantOf(c[e],b);return d},clean:function(a){this.eachNode(a,function(a){a._flag=
!1})},getClosestNodeToOrigin:function(a,b,c){return this.getClosestNodeToPos(a,E.KER,b,c)},getClosestNodeToPos:function(a,b,c,d){var e=null;c=c||"current";b=b&&b.getc(!0)||z.KER;var f=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};this.eachNode(a,function(a){e=null==e||f(a.getPos(c).getc(!0),b)<f(e.getPos(c).getc(!0),b)?a:e},d);return e}};g.each("get getNode each eachNode computeLevels eachBFS clean getClosestNodeToPos getClosestNodeToOrigin".split(" "),function(a){k.prototype[a]=function(){return k.Util[a].apply(k.Util,
[this].concat(Array.prototype.slice.call(arguments)))}});g.each("eachAdjacency eachLevel eachSubgraph eachSubnode anySubnode getSubnodes getParents isDescendantOf".split(" "),function(a){k.Node.prototype[a]=function(){return k.Util[a].apply(k.Util,[this].concat(Array.prototype.slice.call(arguments)))}});k.Op={options:{type:"nothing",duration:2E3,hideLabels:!0,fps:30},initialize:function(a){this.viz=a},removeNode:function(a,b){var c=this.viz,d=g.merge(this.options,c.controller,b),e=g.splat(a),f,h,
m;switch(d.type){case "nothing":for(f=0;f<e.length;f++)c.graph.removeNode(e[f]);break;case "replot":this.removeNode(e,{type:"nothing"});c.labels.clearLabels();c.refresh(!0);break;case "fade:seq":case "fade":h=this;for(f=0;f<e.length;f++)m=c.graph.getNode(e[f]),m.setData("alpha",0,"end");c.fx.animate(g.merge(d,{modes:["node-property:alpha"],onComplete:function(){h.removeNode(e,{type:"nothing"});c.labels.clearLabels();c.reposition();c.fx.animate(g.merge(d,{modes:["linear"]}))}}));break;case "fade:con":h=
this;for(f=0;f<e.length;f++)m=c.graph.getNode(e[f]),m.setData("alpha",0,"end"),m.ignore=!0;c.reposition();c.fx.animate(g.merge(d,{modes:["node-property:alpha","linear"],onComplete:function(){h.removeNode(e,{type:"nothing"});d.onComplete&&d.onComplete()}}));break;case "iter":h=this;c.fx.sequence({condition:function(){return 0!=e.length},step:function(){h.removeNode(e.shift(),{type:"nothing"});c.labels.clearLabels()},onComplete:function(){d.onComplete&&d.onComplete()},duration:Math.ceil(d.duration/
e.length)});break;default:this.doError()}},removeEdge:function(a,b){var c=this.viz,d=g.merge(this.options,c.controller,b),e="string"==g.type(a[0])?[a]:a,f,h,m;switch(d.type){case "nothing":for(f=0;f<e.length;f++)c.graph.removeAdjacence(e[f][0],e[f][1]);break;case "replot":this.removeEdge(e,{type:"nothing"});c.refresh(!0);break;case "fade:seq":case "fade":h=this;for(f=0;f<e.length;f++)(m=c.graph.getAdjacence(e[f][0],e[f][1]))&&m.setData("alpha",0,"end");c.fx.animate(g.merge(d,{modes:["edge-property:alpha"],
onComplete:function(){h.removeEdge(e,{type:"nothing"});c.reposition();c.fx.animate(g.merge(d,{modes:["linear"]}))}}));break;case "fade:con":h=this;for(f=0;f<e.length;f++)if(m=c.graph.getAdjacence(e[f][0],e[f][1]))m.setData("alpha",0,"end"),m.ignore=!0;c.reposition();c.fx.animate(g.merge(d,{modes:["edge-property:alpha","linear"],onComplete:function(){h.removeEdge(e,{type:"nothing"});d.onComplete&&d.onComplete()}}));break;case "iter":h=this;c.fx.sequence({condition:function(){return 0!=e.length},step:function(){h.removeEdge(e.shift(),
{type:"nothing"});c.labels.clearLabels()},onComplete:function(){d.onComplete()},duration:Math.ceil(d.duration/e.length)});break;default:this.doError()}},sum:function(a,b){var c=this.viz,d=g.merge(this.options,c.controller,b),e=c.root,f;c.root=b.id||c.root;switch(d.type){case "nothing":f=c.construct(a);f.eachNode(function(a){a.eachAdjacency(function(a){c.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data)})});break;case "replot":c.refresh(!0);this.sum(a,{type:"nothing"});c.refresh(!0);break;case "fade:seq":case "fade":case "fade:con":that=
this;f=c.construct(a);var h=!this.preprocessSum(f)?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];c.reposition();"fade:con"!=d.type?c.fx.animate(g.merge(d,{modes:["linear"],onComplete:function(){c.fx.animate(g.merge(d,{modes:h,onComplete:function(){d.onComplete()}}))}})):(c.graph.eachNode(function(a){a.id!=e&&a.pos.isZero()&&(a.pos.set(a.endPos),a.startPos.set(a.endPos))}),c.fx.animate(g.merge(d,{modes:["linear"].concat(h)})));break;default:this.doError()}},morph:function(a,
b,c){c=c||{};var d=this.viz,e=g.merge(this.options,d.controller,b),f=d.root,h;d.root=b.id||d.root;switch(e.type){case "nothing":h=d.construct(a);h.eachNode(function(a){var b=d.graph.hasNode(a.id);a.eachAdjacency(function(a){var b=!!d.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id);d.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data);if(b){var b=d.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id),c;for(c in a.data||{})b.data[c]=a.data[c]}});if(b){var b=d.graph.getNode(a.id),c;for(c in a.data||{})b.data[c]=a.data[c]}});
d.graph.eachNode(function(a){a.eachAdjacency(function(a){h.getAdjacence(a.nodeFrom.id,a.nodeTo.id)||d.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)});h.hasNode(a.id)||d.graph.removeNode(a.id)});break;case "replot":d.labels.clearLabels(!0);this.morph(a,{type:"nothing"});d.refresh(!0);d.refresh(!0);break;case "fade:seq":case "fade":case "fade:con":that=this;h=d.construct(a);var m="node-property"in c&&g.map(g.splat(c["node-property"]),function(a){return"$"+a});d.graph.eachNode(function(a){var b=h.getNode(a.id);
if(b){var b=b.data,c;for(c in b)m&&-1<g.indexOf(m,c)?a.endData[c]=b[c]:a.data[c]=b[c]}else a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end"),a.ignore=!0});d.graph.eachNode(function(a){a.ignore||a.eachAdjacency(function(a){if(!a.nodeFrom.ignore&&!a.nodeTo.ignore){var b=h.getNode(a.nodeFrom.id);a=h.getNode(a.nodeTo.id);b.adjacentTo(a)||(a=d.graph.getAdjacence(b.id,a.id),n=!0,a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end"))}})});var n=this.preprocessSum(h);
a=!n?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];a[0]+="node-property"in c?":"+g.splat(c["node-property"]).join(":"):"";a[1]=(a[1]||"edge-property:alpha")+("edge-property"in c?":"+g.splat(c["edge-property"]).join(":"):"");"label-property"in c&&a.push("label-property:"+g.splat(c["label-property"]).join(":"));d.reposition?d.reposition():d.compute("end");d.graph.eachNode(function(a){a.id!=f&&a.pos.getp().equals(E.KER)&&(a.pos.set(a.endPos),a.startPos.set(a.endPos))});d.fx.animate(g.merge(e,
{modes:[c.position||"polar"].concat(a),onComplete:function(){d.graph.eachNode(function(a){a.ignore&&d.graph.removeNode(a.id)});d.graph.eachNode(function(a){a.eachAdjacency(function(a){a.ignore&&d.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)})});e.onComplete()}}))}},contract:function(a,b){var c=this.viz;!a.collapsed&&a.anySubnode(g.lambda(!0))&&(b=g.merge(this.options,c.config,b||{},{modes:["node-property:alpha:span","linear"]}),a.collapsed=!0,function e(a){a.eachSubnode(function(a){a.ignore=!0;
a.setData("alpha",0,"animate"==b.type?"end":"current");e(a)})}(a),"animate"==b.type?(c.compute("end"),c.rotated&&c.rotate(c.rotated,"none",{property:"end"}),function f(b){b.eachSubnode(function(b){b.setPos(a.getPos("end"),"end");f(b)})}(a),c.fx.animate(b)):"replot"==b.type&&c.refresh())},expand:function(a,b){if("collapsed"in a){var c=this.viz;b=g.merge(this.options,c.config,b||{},{modes:["node-property:alpha:span","linear"]});delete a.collapsed;(function e(a){a.eachSubnode(function(a){delete a.ignore;
a.setData("alpha",1,"animate"==b.type?"end":"current");e(a)})})(a);"animate"==b.type?(c.compute("end"),c.rotated&&c.rotate(c.rotated,"none",{property:"end"}),c.fx.animate(b)):"replot"==b.type&&c.refresh()}},preprocessSum:function(a){var b=this.viz;a.eachNode(function(a){b.graph.hasNode(a.id)||(b.graph.addNode(a),a=b.graph.getNode(a.id),a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end"))});var c=!1;a.eachNode(function(a){a.eachAdjacency(function(a){var d=b.graph.getNode(a.nodeFrom.id),
h=b.graph.getNode(a.nodeTo.id);d.adjacentTo(h)||(a=b.graph.addAdjacence(d,h,a.data),d.startAlpha==d.endAlpha&&h.startAlpha==h.endAlpha&&(c=!0,a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end")))})});return c}};var W={none:{render:g.empty,contains:g.lambda(!1)},circle:{render:function(a,b,c,d){d=d.getCtx();d.beginPath();d.arc(b.x,b.y,c,0,2*Math.PI,!0);d.closePath();d[a]()},contains:function(a,b,c){var d=a.x-b.x;a=a.y-b.y;return d*d+a*a<=c*c}},ellipse:{render:function(a,b,
c,d,e){e=e.getCtx();var f=1,h=1,m=1,g=1,l=0;c>d?(l=c/2,h=d/c,g=c/d):(l=d/2,f=c/d,m=d/c);e.save();e.scale(f,h);e.beginPath();e.arc(b.x*m,b.y*g,l,0,2*Math.PI,!0);e.closePath();e[a]();e.restore()},contains:function(a,b,c,d){var e=0,f=1,h=1,m=0,g=0;c>d?(e=c/2,h=d/c):(e=d/2,f=c/d);m=(a.x-b.x)*(1/f);g=(a.y-b.y)*(1/h);return m*m+g*g<=e*e}},square:{render:function(a,b,c,d){d.getCtx()[a+"Rect"](b.x-c,b.y-c,2*c,2*c)},contains:function(a,b,c){return Math.abs(b.x-a.x)<=c&&Math.abs(b.y-a.y)<=c}},rectangle:{render:function(a,
b,c,d,e){e.getCtx()[a+"Rect"](b.x-c/2,b.y-d/2,c,d)},contains:function(a,b,c,d){return Math.abs(b.x-a.x)<=c/2&&Math.abs(b.y-a.y)<=d/2}},triangle:{render:function(a,b,c,d){d=d.getCtx();var e=b.x,f=b.y-c,h=e-c;b=b.y+c;c=e+c;d.beginPath();d.moveTo(e,f);d.lineTo(h,b);d.lineTo(c,b);d.closePath();d[a]()},contains:function(a,b,c){return W.circle.contains(a,b,c)}},star:{render:function(a,b,c,d){d=d.getCtx();var e=Math.PI/5;d.save();d.translate(b.x,b.y);d.beginPath();d.moveTo(c,0);for(b=0;9>b;b++)d.rotate(e),
0==b%2?d.lineTo(0.200811*(c/0.525731),0):d.lineTo(c,0);d.closePath();d[a]();d.restore()},contains:function(a,b,c){return W.circle.contains(a,b,c)}}},ba={line:{render:function(a,b,c){c=c.getCtx();c.beginPath();c.moveTo(a.x,a.y);c.lineTo(b.x,b.y);c.stroke()},contains:function(a,b,c,d){var e=Math.min,f=Math.max,h=e(a.x,b.x),m=f(a.x,b.x),e=e(a.y,b.y),f=f(a.y,b.y);return c.x>=h&&c.x<=m&&c.y>=e&&c.y<=f?Math.abs(b.x-a.x)<=d?!0:Math.abs((b.y-a.y)/(b.x-a.x)*(c.x-a.x)+a.y-c.y)<=d:!1}},arrow:{render:function(a,
b,c,d,e){e=e.getCtx();d&&(d=a,a=b,b=d);d=new z(b.x-a.x,b.y-a.y);d.$scale(c/d.norm());c=new z(b.x-d.x,b.y-d.y);var f=new z(-d.y/2,d.x/2);d=c.add(f);c=c.$add(f.$scale(-1));e.beginPath();e.moveTo(a.x,a.y);e.lineTo(b.x,b.y);e.stroke();e.beginPath();e.moveTo(d.x,d.y);e.lineTo(c.x,c.y);e.lineTo(b.x,b.y);e.closePath();e.fill()},contains:function(a,b,c,d){return ba.line.contains(a,b,c,d)}},hyperline:{render:function(a,b,c,d){var e,f,h,m,g;function l(a,b){return a<b?a+Math.PI>b?!1:!0:b+Math.PI>a?!0:!1}d=d.getCtx();
e=a.x*b.y-a.y*b.x;f=a.squaredNorm();g=b.squaredNorm();0==e?(f=e=0,h=-1,g=m=void 0):(m=(a.y*g-b.y*f+a.y-b.y)/e,g=(b.x*f-a.x*g+b.x-a.x)/e,e=-m/2,f=-g/2,h=(m*m+g*g)/4-1,0>h?(f=e=0,h=-1,g=m=void 0):(h=Math.sqrt(h),h=1E3<h?-1:h));1E3<m||1E3<g||0>h?(d.beginPath(),d.moveTo(a.x*c,a.y*c),d.lineTo(b.x*c,b.y*c)):(b=Math.atan2(b.y-f,b.x-e),a=Math.atan2(a.y-f,a.x-e),l=l(b,a),d.beginPath(),d.arc(e*c,f*c,h*c,b,a,l));d.stroke()},contains:g.lambda(!1)}};k.Plot={initialize:function(a,b){this.viz=a;this.config=a.config;
this.node=a.config.Node;this.edge=a.config.Edge;this.animation=new P;this.nodeTypes=new b.Plot.NodeTypes;this.edgeTypes=new b.Plot.EdgeTypes;this.labels=a.labels},nodeHelper:W,edgeHelper:ba,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",
shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(a,b,c){return a+(b-a)*c},moebius:function(a,b,c,d){b=d.scale(-c);if(1>b.norm()){c=b.x;d=b.y;var e=a.startPos.getc().moebiusTransformation(b);a.pos.setc(e.x,e.y);b.x=c;b.y=d}},linear:function(a,b,c){b=a.startPos.getc(!0);var d=a.endPos.getc(!0);a.pos.setc(this.compute(b.x,d.x,c),this.compute(b.y,d.y,c))},polar:function(a,b,c){b=a.startPos.getp(!0);c=a.endPos.getp().interpolate(b,
c);a.pos.setp(c.theta,c.rho)},number:function(a,b,c,d,e){var f=a[d](b,"start");d=a[d](b,"end");a[e](b,this.compute(f,d,c))},color:function(a,b,c,d,e){var f=g.hexToRgb(a[d](b,"start"));d=g.hexToRgb(a[d](b,"end"));var h=this.compute;c=g.rgbToHex([parseInt(h(f[0],d[0],c)),parseInt(h(f[1],d[1],c)),parseInt(h(f[2],d[2],c))]);a[e](b,c)},"array-number":function(a,b,c,d,e){var f=a[d](b,"start");d=a[d](b,"end");for(var h=[],m=0,g=f.length;m<g;m++){var l=f[m],q=d[m];if(l.length){for(var s=0,p=l.length,I=[];s<
p;s++)I.push(this.compute(l[s],q[s],c));h.push(I)}else h.push(this.compute(l,q,c))}a[e](b,h)},node:function(a,b,c,d,e,f){d=this[d];if(b)for(var h=b.length,m=0;m<h;m++){var g=b[m];this[d[g]](a,g,c,e,f)}else for(g in d)this[d[g]](a,g,c,e,f)},edge:function(a,b,c,d,e,f){a=a.adjacencies;for(var h in a)this.node(a[h],b,c,d,e,f)},"node-property":function(a,b,c){this.node(a,b,c,"map","getData","setData")},"edge-property":function(a,b,c){this.edge(a,b,c,"map","getData","setData")},"label-property":function(a,
b,c){this.node(a,b,c,"label","getLabelData","setLabelData")},"node-style":function(a,b,c){this.node(a,b,c,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(a,b,c){this.edge(a,b,c,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(a){var b=this;a=g.merge({condition:g.lambda(!1),step:g.empty,onComplete:g.empty,duration:200},a||{});var c=setInterval(function(){a.condition()?a.step():(clearInterval(c),a.onComplete());b.viz.refresh(!0)},a.duration)},prepare:function(a){var b=
this.viz.graph,c={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},d={};if("array"==g.type(a))for(var e=0,f=a.length;e<f;e++){var h=a[e].split(":");d[h.shift()]=h}else for(e in a)"position"==e?d[a.position]=[]:d[e]=g.splat(a[e]);b.eachNode(function(a){a.startPos.set(a.pos);g.each(["node-property","node-style"],function(b){if(b in
d)for(var e=d[b],f=0,h=e.length;f<h;f++)a[c[b].setter](e[f],a[c[b].getter](e[f]),"start")});g.each(["edge-property","edge-style"],function(b){if(b in d){var e=d[b];a.eachAdjacency(function(a){for(var d=0,f=e.length;d<f;d++)a[c[b].setter](e[d],a[c[b].getter](e[d]),"start")})}})});return d},animate:function(a,b){a=g.merge(this.viz.config,a||{});var c=this,d=this.viz.graph,e=this.Interpolator,f="nodefx"===a.type?this.nodeFxAnimation:this.animation,h=this.prepare(a.modes);a.hideLabels&&this.labels.hideLabels(!0);
f.setOptions(g.extend(a,{$animating:!1,compute:function(f){d.eachNode(function(a){for(var c in h)e[c](a,h[c],f,b)});c.plot(a,this.$animating,f);this.$animating=!0},complete:function(){a.hideLabels&&c.labels.hideLabels(!1);c.plot(a);a.onComplete()}})).start()},nodeFx:function(a){var b=this.viz,c=b.graph,d=this.nodeFxAnimation,e=g.merge(this.viz.config,{elements:{id:!1,properties:{}},reposition:!1});a=g.merge(e,a||{},{onBeforeCompute:g.empty,onAfterCompute:g.empty});d.stopTimer();var f=a.elements.properties;
a.elements.id?(d=g.splat(a.elements.id),g.each(d,function(a){if(a=c.getNode(a))for(var b in f)a.setData(b,f[b],"end")})):c.eachNode(function(a){for(var b in f)a.setData(b,f[b],"end")});var d=[],h;for(h in f)d.push(h);h=["node-property:"+d.join(":")];a.reposition&&(h.push("linear"),b.compute("end"));this.animate(g.merge(a,{modes:h,type:"nodefx"}))},plot:function(a,b){var c=this.viz,d=c.graph,e=c.canvas,c=c.root,f=this;e.getCtx();a=a||this.viz.controller;a.clearCanvas&&e.clear();if(c=d.getNode(c)){var h=
!!c.visited;d.eachNode(function(c){var d=c.getData("alpha");c.eachAdjacency(function(d){var g=d.nodeTo;!!g.visited===h&&(c.drawn&&g.drawn)&&(!b&&a.onBeforePlotLine(d),f.plotLine(d,e,b),!b&&a.onAfterPlotLine(d))});c.drawn&&(!b&&a.onBeforePlotNode(c),f.plotNode(c,e,b),!b&&a.onAfterPlotNode(c));!f.labelsHidden&&a.withLabels&&(c.drawn&&0.95<=d?f.labels.plotLabel(e,c,a):f.labels.hideLabel(c,!1));c.visited=!h})}},plotTree:function(a,b,c){var d=this,e=this.viz.canvas;e.getCtx();var f=a.getData("alpha");
a.eachSubnode(function(f){if(b.plotSubtree(a,f)&&f.exist&&f.drawn){var g=a.getAdjacency(f.id);!c&&b.onBeforePlotLine(g);d.plotLine(g,e,c);!c&&b.onAfterPlotLine(g);d.plotTree(f,b,c)}});a.drawn?(!c&&b.onBeforePlotNode(a),this.plotNode(a,e,c),!c&&b.onAfterPlotNode(a),!b.hideLabels&&b.withLabels&&0.95<=f?this.labels.plotLabel(e,a,b):this.labels.hideLabel(a,!1)):this.labels.hideLabel(a,!0)},plotNode:function(a,b,c){var d=a.getData("type"),e=this.node.CanvasStyles;if("none"!=d){var f=a.getData("lineWidth"),
h=a.getData("color"),g=a.getData("alpha"),n=b.getCtx();n.save();n.lineWidth=f;n.fillStyle=n.strokeStyle=h;n.globalAlpha=g;for(var l in e)n[l]=a.getCanvasStyle(l);this.nodeTypes[d].render.call(this,a,b,c);n.restore()}},plotLine:function(a,b,c){var d=a.getData("type"),e=this.edge.CanvasStyles;if("none"!=d){var f=a.getData("lineWidth"),h=a.getData("color"),g=b.getCtx(),n=a.nodeFrom,l=a.nodeTo;g.save();g.lineWidth=f;g.fillStyle=g.strokeStyle=h;g.globalAlpha=Math.min(n.getData("alpha"),l.getData("alpha"),
a.getData("alpha"));for(var q in e)g[q]=a.getCanvasStyle(q);this.edgeTypes[d].render.call(this,a,b,c);g.restore()}}};k.Plot3D=g.merge(k.Plot,{Interpolator:{linear:function(a,b,c){b=a.startPos.getc(!0);var d=a.endPos.getc(!0);a.pos.setc(this.compute(b.x,d.x,c),this.compute(b.y,d.y,c),this.compute(b.z,d.z,c))}},plotNode:function(a,b){"none"!=a.getData("type")&&this.plotElement(a,b,{getAlpha:function(){return a.getData("alpha")}})},plotLine:function(a,b){"none"!=a.getData("type")&&this.plotElement(a,
b,{getAlpha:function(){return Math.min(a.nodeFrom.getData("alpha"),a.nodeTo.getData("alpha"),a.getData("alpha"))}})},plotElement:function(a,b,c){var d=b.getCtx(),e=new Matrix4,f=b.config.Scene.Lighting,h=b.canvases[0];b=h.program;h=h.camera;a.geometry||(a.geometry=new (O3D[a.getData("type")]));a.geometry.update(a);if(!a.webGLVertexBuffer){for(var m=[],n=[],l=[],q=0,s=a.geometry,p=0,I=s.vertices,s=s.faces,j=s.length;p<j;p++){var u=s[p],k=I[u.a],K=I[u.b],w=I[u.c],N=u.d?I[u.d]:!1,u=u.normal;m.push(k.x,
k.y,k.z);m.push(K.x,K.y,K.z);m.push(w.x,w.y,w.z);N&&m.push(N.x,N.y,N.z);l.push(u.x,u.y,u.z);l.push(u.x,u.y,u.z);l.push(u.x,u.y,u.z);N&&l.push(u.x,u.y,u.z);n.push(q,q+1,q+2);N?(n.push(q,q+2,q+3),q+=4):q+=3}a.webGLVertexBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.webGLVertexBuffer);d.bufferData(d.ARRAY_BUFFER,new Float32Array(m),d.STATIC_DRAW);a.webGLFaceBuffer=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),d.STATIC_DRAW);
a.webGLFaceCount=n.length;a.webGLNormalBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.webGLNormalBuffer);d.bufferData(d.ARRAY_BUFFER,new Float32Array(l),d.STATIC_DRAW)}e.multiply(h.matrix,a.geometry.matrix);d.uniformMatrix4fv(b.viewMatrix,!1,e.flatten());d.uniformMatrix4fv(b.projectionMatrix,!1,h.projectionMatrix.flatten());e=Matrix4.makeInvert(e);e.$transpose();d.uniformMatrix4fv(b.normalMatrix,!1,e.flatten());e=g.hexToRgb(a.getData("color"));e.push(c.getAlpha());d.uniform4f(b.color,e[0]/
255,e[1]/255,e[2]/255,e[3]);d.uniform1i(b.enableLighting,f.enable);f.enable&&(f.ambient&&(c=f.ambient,d.uniform3f(b.ambientColor,c[0],c[1],c[2])),f.directional&&(f=f.directional,e=f.color,f=f.direction,f=(new Vector3(f.x,f.y,f.z)).normalize().$scale(-1),d.uniform3f(b.lightingDirection,f.x,f.y,f.z),d.uniform3f(b.directionalColor,e[0],e[1],e[2])));d.bindBuffer(d.ARRAY_BUFFER,a.webGLVertexBuffer);d.vertexAttribPointer(b.position,3,d.FLOAT,!1,0,0);d.bindBuffer(d.ARRAY_BUFFER,a.webGLNormalBuffer);d.vertexAttribPointer(b.normal,
3,d.FLOAT,!1,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer);d.drawElements(d.TRIANGLES,a.webGLFaceCount,d.UNSIGNED_SHORT,0)}});k.Label={};k.Label.Native=new j({initialize:function(a){this.viz=a},plotLabel:function(a,b,c){var d=a.getCtx();b.pos.getc(!0);d.font=b.getLabelData("style")+" "+b.getLabelData("size")+"px "+b.getLabelData("family");d.textAlign=b.getLabelData("textAlign");d.fillStyle=d.strokeStyle=b.getLabelData("color");d.textBaseline=b.getLabelData("textBaseline");this.renderLabel(a,
b,c)},renderLabel:function(a,b){var c=a.getCtx(),d=b.pos.getc(!0);c.fillText(b.name,d.x,d.y+b.getData("height")/2)},hideLabel:g.empty,hideLabels:g.empty});k.Label.DOM=new j({labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(a){return a in this.labels&&null!=this.labels[a]?this.labels[a]:this.labels[a]=document.getElementById(a)},hideLabels:function(a){this.getLabelContainer().style.display=
a?"none":"";this.labelsHidden=a},clearLabels:function(a){for(var b in this.labels)if(a||!this.viz.graph.hasNode(b))this.disposeLabel(b),delete this.labels[b]},disposeLabel:function(a){(a=this.getLabel(a))&&a.parentNode&&a.parentNode.removeChild(a)},hideLabel:function(a,b){a=g.splat(a);var c=b?"":"none",d=this;g.each(a,function(a){if(a=d.getLabel(a.id))a.style.display=c})},fitsInCanvas:function(a,b){var c=b.getSize();return a.x>=c.width||0>a.x||a.y>=c.height||0>a.y?!1:!0}});k.Label.HTML=new j({Implements:k.Label.DOM,
plotLabel:function(a,b,c){a=b.id;var d=this.getLabel(a);if(!d&&!(d=document.getElementById(a))){var d=document.createElement("div"),e=this.getLabelContainer();d.id=a;d.className="node";d.style.position="absolute";c.onCreateLabel(d,b);e.appendChild(d);this.labels[b.id]=d}this.placeLabel(d,b,c)}});k.Label.SVG=new j({Implements:k.Label.DOM,plotLabel:function(a,b,c){a=b.id;var d=this.getLabel(a);if(!d&&!(d=document.getElementById(a))){var d=document.createElementNS("http://www.w3.org/2000/svg","svg:text"),
e=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");d.appendChild(e);e=this.getLabelContainer();d.setAttribute("id",a);d.setAttribute("class","node");e.appendChild(d);c.onCreateLabel(d,b);this.labels[b.id]=d}this.placeLabel(d,b,c)}});k.Geom=new j({initialize:function(a){this.viz=a;this.config=a.config;this.node=a.config.Node;this.edge=a.config.Edge},translate:function(a,b){b=g.splat(b);this.viz.graph.eachNode(function(c){g.each(b,function(b){c.getPos(b).$add(a)})})},setRightLevelToShow:function(a,
b,c){var d=this.getRightLevelToShow(a,b),e=this.viz.labels,f=g.merge({execShow:!0,execHide:!0,onHide:g.empty,onShow:g.empty},c||{});a.eachLevel(0,this.config.levelsToShow,function(b){b._depth-a._depth>d?(f.onHide(b),f.execHide&&(b.drawn=!1,b.exist=!1,e.hideLabel(b,!1))):(f.onShow(b),f.execShow&&(b.exist=!0))});a.drawn=!0},getRightLevelToShow:function(a,b){var c=this.config,d=c.levelsToShow;if(!c.constrained)return d;for(;!this.treeFitsInCanvas(a,b,d)&&1<d;)d--;return d}});var x={construct:function(a){var b=
"array"==g.type(a),c=new k(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);if(b)for(var b=function(b){for(var d=0,e=a.length;d<e;d++)if(a[d].id==b)return a[d];return c.addNode({id:b,name:b})},d=0,e=a.length;d<e;d++){c.addNode(a[d]);var f=a[d].adjacencies;if(f)for(var h=0,m=f.length;h<m;h++){var n=f[h],l={};"string"!=typeof f[h]&&(l=g.merge(n.data,{}),n=n.nodeTo);c.addAdjacence(a[d],b(n),l)}}else(function(a,b){a.addNode(b);if(b.children)for(var c=0,d=b.children;c<d.length;c++)a.addAdjacence(b,
d[c]),arguments.callee(a,d[c])})(c,a);return c},loadJSON:function(a,b){this.json=a;this.labels&&this.labels.clearLabels&&this.labels.clearLabels(!0);this.graph=this.construct(a);this.root="array"!=g.type(a)?a.id:a[b?b:0].id},toJSON:function(a){if("tree"==(a||"tree"))var b={},b=function e(a){var b={};b.id=a.id;b.name=a.name;b.data=a.data;var c=[];a.eachSubnode(function(a){c.push(e(a))});b.children=c;return b}(this.graph.getNode(this.root));else{var b=[],c=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(a){var f=
{};f.id=a.id;f.name=a.name;f.data=a.data;var h=[];a.eachAdjacency(function(a){var b=a.nodeTo;if(!!b.visited===c){var e={};e.nodeTo=b.id;e.data=a.data;h.push(e)}});f.adjacencies=h;b.push(f);a.visited=!c})}return b}},y=$jit.Layouts={},X={label:null,compute:function(a,b,c){this.initializeLabel(c);var d=this.label,e=d.style;a.eachNode(function(a){var b=a.getData("autoWidth"),c=a.getData("autoHeight");if(b||c){delete a.data.$width;delete a.data.$height;delete a.data.$dim;var n=a.getData("width"),l=a.getData("height");
e.width=b?"auto":n+"px";e.height=c?"auto":l+"px";d.innerHTML=a.name;b=d.offsetWidth;c=d.offsetHeight;n=a.getData("type");-1===g.indexOf(["circle","square","triangle","star"],n)?(a.setData("width",b),a.setData("height",c)):(b=b>c?b:c,a.setData("width",b),a.setData("height",b),a.setData("dim",b))}})},initializeLabel:function(a){this.label||(this.label=document.createElement("div"),document.body.appendChild(this.label));this.setLabelStyles(a)},setLabelStyles:function(){g.extend(this.label.style,{visibility:"hidden",
position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}},r,Y=function(a,b){var c=[];g.each(a,function(a){a=ca.call(a);a[0]+=b;a[1]+=b;c.push(a)});return c},R=function(a,b){if(0==a.length)return b;if(0==b.length)return a;var c=a.shift(),d=b.shift();return[[c[0],d[1]]].concat(R(a,b))},da=function(a,b){b=b||[];if(0==a.length)return b;var c=a.pop();return da(a,R(c,b))},Z=function(a,b,c,d,e){if(a.length<=e||b.length<=e)return 0;var f=a[e][1],h=b[e][0];return Math.max(Z(a,
b,c,d,++e)+c,f-h+d)},ca=Array.prototype.slice;r=new j({compute:function(a,b){var c=a||"start",d=this.graph.getNode(this.root);g.extend(d,{drawn:!0,exist:!0,selected:!0});X.compute(this.graph,c,this.config);(b||!("_depth"in d))&&this.graph.computeLevels(this.root,0,"ignore");this.computePositions(d,c)},computePositions:function(a,b){var c=this.config,d=c.multitree,e=c.align,f="center"!==e&&c.indent,c=c.orientation,h=this;g.each(d?["top","right","bottom","left"]:[c],function(c){var g=h.graph,l=h.config,
q=function(a,d,e){var f=a.getData(K,b),h=[],p=[],j=!1,I=(d||a.getData(w,b))+l.levelDistance;a.eachSubnode(function(a){if(a.exist&&(!s||"$orn"in a.data&&a.data.$orn==c)){if(!j){var d=a._depth,f=l.Node,u=l.multitree;if(f.overridable){var k=-1,M=-1;g.eachNode(function(a){if(a._depth==d&&(!u||"$orn"in a.data&&a.data.$orn==c)){var e=a.getData("width",b);a=a.getData("height",b);k=k<e?e:k;M=M<a?a:M}});j={width:0>k?f.width:k,height:0>M?f.height:M}}else j=f}a=q(a,j[w],e+I);h.push(a.tree);p.push(a.extent)}});
var M=C,D=N;d=B;var r,v=function(a,b,c){if(b.length<=c)return[];var d=b[c],e=Z(a,d,M,D,0);return[e].concat(v(R(a,Y(d,e)),b,++c))};r=v([],p,0);var x,y=function(a,b,c){if(b.length<=c)return[];var d=b[c],e=-Z(d,a,M,D,0);return[e].concat(y(R(Y(d,e),a),b,++c))};x=ca.call(p);x=y([],x.reverse(),0).reverse();"left"==d?x=r:"right"==d&&(r=x);var t=0;for(d=[];t<r.length;t++)d[t]=(r[t]+x[t])/2;r=0;for(x=[];r<h.length;r++){var t=d[r],z="left"==c||"right"==c?"y":"x";h[r].getPos(b)[z]+=t;x.push(Y(p[r],d[r]))}f=
[[-f/2,f/2]].concat(da(x));a.getPos(b)[u]=0;"top"==c||"left"==c?a.getPos(b)[k]=e:a.getPos(b)[k]=-e;return{tree:a,extent:f}},s=l.multitree,p=["x","y"],I=["width","height"],j=+("left"==c||"right"==c),u=p[j],k=p[1-j],K=I[j],w=I[1-j],N=l.siblingOffset,C=l.subtreeOffset,B=l.align;q(a,!1,0);var D=["x","y"][+("left"==c||"right"==c)];(function ia(a){a.eachSubnode(function(h){if(h.exist&&(!d||"$orn"in h.data&&h.data.$orn==c))h.getPos(b)[D]+=a.getPos(b)[D],f&&(h.getPos(b)[D]+="left"==e?f:-f),ia(h)})})(a)})}});
y.Tree=r;r=$jit;var ea,fa=function(a){a=a||this.clickedNode;if(!this.config.constrained)return[];var b=this.geom,c=this.canvas,d=a._depth,e=[];this.graph.eachNode(function(b){b.exist&&!b.selected&&(b.isDescendantOf(a.id)?b._depth<=d&&e.push(b):e.push(b))});b=b.getRightLevelToShow(a,c);a.eachLevel(b,b,function(a){a.exist&&!a.selected&&e.push(a)});for(b=0;b<O.length;b++)c=this.graph.getNode(O[b]),c.isDescendantOf(a.id)||e.push(c);return e},ga=function(){var a=[],b=this.config;this.clickedNode.eachLevel(0,
b.levelsToShow,function(c){b.multitree&&!("$orn"in c.data)&&c.anySubnode(function(a){return a.exist&&!a.drawn})?a.push(c):c.drawn&&!c.anySubnode("drawn")&&a.push(c)});return a},O=[];ea=new j({Implements:[x,H,y.Tree],initialize:function(a){var b=$jit.ST;a=this.controller=this.config=g.merge(v("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),{levelsToShow:2,levelDistance:30,constrained:!0,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0},a);
a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(a.background&&(a.background=g.merge({type:"Circles"},a.background)),this.canvas=new G(this,a),this.config.labelContainer=("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:z};this.graph=new k(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new b.Label[a.Label.type](this);this.fx=new b.Plot(this,b);this.op=new b.Op(this);this.group=new b.Group(this);
this.geom=new b.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(a,b,c){var d=this.geom,e=this.fx,f=this;e.busy||(e.busy=!0,this.contract({onComplete:function(){d.switchOrientation(a);f.compute("end",!1);e.busy=!1;if("animate"==b)f.onClick(f.clickedNode.id,c);else"replot"==b&&f.select(f.clickedNode.id,c)}},a))},switchAlignment:function(a,b,c){this.config.align=a;if("animate"==b)this.select(this.clickedNode.id,c);else if("replot"==
b)this.onClick(this.clickedNode.id,c)},addNodeInPath:function(a){O.push(a);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(){O.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(a){a.exist&&
(a.drawn=!0)});this.compute("end")},requestNodes:function(a,b){var c=g.merge(this.controller,b),d=this.config.levelsToShow;if(c.request){var e=[],f=a._depth;a.eachLevel(0,d,function(a){a.drawn&&!a.anySubnode()&&(e.push(a),a._level=d-(a._depth-f))});this.group.requestNodes(e,c)}else c.onComplete()},contract:function(a,b){var c=this.config.orientation,d=this.geom,e=this.group;b&&d.switchOrientation(b);var f=fa.call(this);b&&d.switchOrientation(c);e.contract(f,g.merge(this.controller,a))},move:function(a,
b){this.compute("end",!1);var c=b.Move,d={x:c.offsetX,y:c.offsetY};c.enable&&this.geom.translate(a.endPos.add(d).$scale(-1),"end");this.fx.animate(g.merge(this.controller,{modes:["linear"]},b))},expand:function(a,b){var c=ga.call(this,a);this.group.expand(c,g.merge(this.controller,b))},selectPath:function(a){function b(a){null==a||a.selected||(a.selected=!0,g.each(c.group.getSiblings([a])[a.id],function(a){a.exist=!0;a.drawn=!0}),a=a.getParents(),a=0<a.length?a[0]:null,b(a))}var c=this;this.graph.eachNode(function(a){a.selected=
!1});var d=0;for(a=[a.id].concat(O);d<a.length;d++)b(this.graph.getNode(a[d]))},setRoot:function(a,b,c){function d(){if(this.config.multitree&&g.data.$orn){var b={left:"right",right:"left",top:"bottom",bottom:"top"}[g.data.$orn];h.data.$orn=b;(function q(c){c.eachSubnode(function(c){c.id!=a&&(c.data.$orn=b,q(c))})})(h);delete g.data.$orn}this.root=a;this.clickedNode=g;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(g,f,{execHide:!1,onShow:function(a){a.drawn||(a.drawn=
!0,a.setData("alpha",1,"end"),a.setData("alpha",0),a.pos.setc(g.pos.x,g.pos.y))}});this.compute("end");this.busy=!0;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){e.busy=!1;e.onClick(a,{onComplete:function(){c&&c.onComplete()}})}})}if(!this.busy){this.busy=!0;var e=this,f=this.canvas,h=this.graph.getNode(this.root),g=this.graph.getNode(a);delete h.data.$orns;"animate"==b?(d.call(this),e.selectPath(g)):"replot"==b&&(d.call(this),this.select(this.root))}},addSubtree:function(a,
b,c){"replot"==b?this.op.sum(a,g.extend({type:"replot"},c||{})):"animate"==b&&this.op.sum(a,g.extend({type:"fade:seq"},c||{}))},removeSubtree:function(a,b,c,d){var e=[];this.graph.getNode(a).eachLevel(+!b,!1,function(a){e.push(a.id)});"replot"==c?this.op.removeNode(e,g.extend({type:"replot"},d||{})):"animate"==c&&this.op.removeNode(e,g.extend({type:"fade:seq"},d||{}))},select:function(a,b){var c=this.group,d=this.geom,e=this.graph.getNode(a),f=this.canvas;this.graph.getNode(this.root);var h=g.merge(this.controller,
b),m=this;h.onBeforeCompute(e);this.selectPath(e);this.clickedNode=e;this.requestNodes(e,{onComplete:function(){c.hide(c.prepare(fa.call(m)),h);d.setRightLevelToShow(e,f);m.compute("current");m.graph.eachNode(function(a){var b=a.pos.getc(!0);a.startPos.setc(b.x,b.y);a.endPos.setc(b.x,b.y);a.visited=!1});m.geom.translate(e.endPos.add({x:h.offsetX,y:h.offsetY}).$scale(-1),["start","current","end"]);c.show(ga.call(m));m.plot();h.onAfterCompute(m.clickedNode);h.onComplete()}})},onClick:function(a,b){var c=
this.canvas,d=this,e=this.geom,f=this.config,h=g.merge(this.controller,{Move:{enable:!0,offsetX:f.offsetX||0,offsetY:f.offsetY||0},setRightLevelToShowConfig:!1,onBeforeRequest:g.empty,onBeforeContract:g.empty,onBeforeMove:g.empty,onBeforeExpand:g.empty},b);if(!this.busy){this.busy=!0;var m=this.graph.getNode(a);this.selectPath(m,this.clickedNode);this.clickedNode=m;h.onBeforeCompute(m);h.onBeforeRequest(m);this.requestNodes(m,{onComplete:function(){h.onBeforeContract(m);d.contract({onComplete:function(){e.setRightLevelToShow(m,
c,h.setRightLevelToShowConfig);h.onBeforeMove(m);d.move(m,{Move:h.Move,onComplete:function(){h.onBeforeExpand(m);d.expand(m,{onComplete:function(){d.busy=!1;h.onAfterCompute(a);h.onComplete()}})}})}})}})}}});r.ST=ea;$jit.ST.$extend=!0;$jit.ST.Op=new j({Implements:k.Op});$jit.ST.Group=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config;this.animation=new P;this.nodes=null},requestNodes:function(a,b){var c=0,d=a.length,e=this.viz;if(0==d)b.onComplete();for(var f=0;f<d;f++)b.request(a[f].id,
a[f]._level,{onComplete:function(a,f){f&&f.children&&(f.id=a,e.op.sum(f,{type:"nothing"}));++c==d&&(e.graph.computeLevels(e.root,0),b.onComplete())}})},contract:function(a,b){var c=this;a=this.prepare(a);this.animation.setOptions(g.merge(b,{$animating:!1,compute:function(a){1==a&&(a=0.99);c.plotStep(1-a,b,this.$animating);this.$animating="contract"},complete:function(){c.hide(a,b)}})).start()},hide:function(a,b){for(var c=0;c<a.length;c++)a[c].eachLevel(1,!1,function(a){a.exist&&g.extend(a,{drawn:!1,
exist:!1})});b.onComplete()},expand:function(a,b){var c=this;this.show(a);this.animation.setOptions(g.merge(b,{$animating:!1,compute:function(a){c.plotStep(a,b,this.$animating);this.$animating="expand"},complete:function(){c.plotStep(void 0,b,!1);b.onComplete()}})).start()},show:function(a){var b=this.config;this.prepare(a);g.each(a,function(a){if(b.multitree&&!("$orn"in a.data)){delete a.data.$orns;var d=" ";a.eachSubnode(function(a){"$orn"in a.data&&(0>d.indexOf(a.data.$orn)&&a.exist&&!a.drawn)&&
(d+=a.data.$orn+" ")});a.data.$orns=d}a.eachLevel(0,b.levelsToShow,function(a){a.exist&&(a.drawn=!0)})})},prepare:function(a){return this.nodes=this.getNodesWithChildren(a)},getNodesWithChildren:function(a){var b=[],c=this.config;a.sort(function(a,b){return(a._depth<=b._depth)-(a._depth>=b._depth)});for(var d=0;d<a.length;d++)if(a[d].anySubnode("exist")){for(var e=d+1,f=!1;!f&&e<a.length;e++)if(!c.multitree||"$orn"in a[e].data)f=f||a[d].isDescendantOf(a[e].id);f||b.push(a[d])}return b},plotStep:function(a,
b,c){var d=this.viz,e=this.config,f=d.canvas.getCtx(),h=this.nodes,m,n,l={};for(m=0;m<h.length;m++){n=h[m];l[n.id]=[];var q=e.multitree&&!("$orn"in n.data),s=q&&n.data.$orns;n.eachSubgraph(function(a){if(q&&s&&0<s.indexOf(a.data.$orn)&&a.drawn)a.drawn=!1,l[n.id].push(a);else if((!q||!s)&&a.drawn)a.drawn=!1,l[n.id].push(a)});n.drawn=!0}0<h.length&&d.fx.plot();for(m in l)g.each(l[m],function(a){a.drawn=!0});for(m=0;m<h.length;m++)n=h[m],f.save(),d.fx.plotSubtree(n,b,a,c),f.restore()},getSiblings:function(a){var b=
{};g.each(a,function(a){var d=a.getParents();if(0==d.length)b[a.id]=[a];else{var e=[];d[0].eachSubnode(function(a){e.push(a)});b[a.id]=e}});return b}});$jit.ST.Geom=new j({Implements:k.Geom,switchOrientation:function(a){this.config.orientation=a},dispatch:function(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a.length,d=function(a){return"function"==typeof a?a():a};if(2==c)return"top"==b||"bottom"==b?d(a[0]):d(a[1]);if(4==c)switch(b){case "top":return d(a[0]);case "right":return d(a[1]);
case "bottom":return d(a[2]);case "left":return d(a[3])}},getSize:function(a,b){var c=a.data,d=this.config,e=d.siblingOffset,c=d.multitree&&"$orn"in c&&c.$orn||d.orientation,d=a.getData("width")+e,e=a.getData("height")+e;return b?this.dispatch(c,d,e):this.dispatch(c,e,d)},getTreeBaseSize:function(a,b,c){var d=this.getSize(a,!0),e=0,f=this;if(c(b,a))return d;if(0===b)return 0;a.eachSubnode(function(a){e+=f.getTreeBaseSize(a,b-1,c)});return(d>e?d:e)+this.config.subtreeOffset},getEdge:function(a,b,c){var d=
function(b,c){return function(){return a.pos.add(new z(b,c))}},e=this.node,f=a.getData("width"),h=a.getData("height");if("begin"==b){if("center"==e.align)return this.dispatch(c,d(0,h/2),d(-f/2,0),d(0,-h/2),d(f/2,0));if("left"==e.align)return this.dispatch(c,d(0,h),d(0,0),d(0,0),d(f,0));if("right"==e.align)return this.dispatch(c,d(0,0),d(-f,0),d(0,-h),d(0,0));throw"align: not implemented";}if("end"==b){if("center"==e.align)return this.dispatch(c,d(0,-h/2),d(f/2,0),d(0,h/2),d(-f/2,0));if("left"==e.align)return this.dispatch(c,
d(0,0),d(f,0),d(0,h),d(0,0));if("right"==e.align)return this.dispatch(c,d(0,-h),d(0,0),d(0,0),d(-f,0));throw"align: not implemented";}},getScaledTreePosition:function(a,b){var c=this.node,d=a.getData("width"),e=a.getData("height"),f=this.config.multitree&&"$orn"in a.data&&a.data.$orn||this.config.orientation,h=function(c,d){return function(){return a.pos.add(new z(c,d)).$scale(1-b)}};if("left"==c.align)return this.dispatch(f,h(0,e),h(0,0),h(0,0),h(d,0));if("center"==c.align)return this.dispatch(f,
h(0,e/2),h(-d/2,0),h(0,-e/2),h(d/2,0));if("right"==c.align)return this.dispatch(f,h(0,0),h(-d,0),h(0,-e),h(0,0));throw"align: not implemented";},treeFitsInCanvas:function(a,b,c){b=b.getSize();b=this.dispatch(this.config.multitree&&"$orn"in a.data&&a.data.$orn||this.config.orientation,b.width,b.height);return this.getTreeBaseSize(a,c,function(a,b){return 0===a||!b.anySubnode()})<b}});$jit.ST.Plot=new j({Implements:k.Plot,plotSubtree:function(a,b,c,d){var e=this.viz,f=e.canvas,h=e.config;c=Math.min(Math.max(0.001,
c),1);0<=c&&(a.drawn=!1,f=f.getCtx(),e=e.geom.getScaledTreePosition(a,c),f.translate(e.x,e.y),f.scale(c,c));this.plotTree(a,g.merge(b,{withLabels:!0,hideLabels:!!c,plotSubtree:function(){var b=h.multitree&&!("$orn"in a.data),c=b&&a.getData("orns");return!b||-1<c.indexOf(a.getData("orn"))}}),d);0<=c&&(a.drawn=!0)},getAlignedPos:function(a,b,c){var d=this.node;if("center"==d.align)a={x:a.x-b/2,y:a.y-c/2};else if("left"==d.align)d=this.config.orientation,a="bottom"==d||"top"==d?{x:a.x-b/2,y:a.y}:{x:a.x,
y:a.y-c/2};else if("right"==d.align)d=this.config.orientation,a="bottom"==d||"top"==d?{x:a.x-b/2,y:a.y-c}:{x:a.x-b,y:a.y-c/2};else throw"align: not implemented";return a},getOrientation:function(a){var b=this.config,c=b.orientation;b.multitree&&(b=a.nodeFrom,a=a.nodeTo,c="$orn"in b.data&&b.data.$orn||"$orn"in a.data&&a.data.$orn);return c}});$jit.ST.Label={};$jit.ST.Label.Native=new j({Implements:k.Label.Native,renderLabel:function(a,b){var c=a.getCtx(),d=b.pos.getc(!0),e=b.getData("width"),f=b.getData("height"),
d=this.viz.fx.getAlignedPos(d,e,f);c.fillText(b.name,d.x+e/2,d.y+f/2)}});$jit.ST.Label.DOM=new j({Implements:k.Label.DOM,placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.config,f=e.Node,h=this.viz.canvas,g=b.getData("width"),n=b.getData("height"),l=h.getSize(),q=d.x*h.scaleOffsetX+h.translateOffsetX,d=d.y*h.scaleOffsetY+h.translateOffsetY;if("center"==f.align)g={x:Math.round(q-g/2+l.width/2),y:Math.round(d-n/2+l.height/2)};else if("left"==f.align)e=e.orientation,g="bottom"==e||"top"==e?
{x:Math.round(q-g/2+l.width/2),y:Math.round(d+l.height/2)}:{x:Math.round(q+l.width/2),y:Math.round(d-n/2+l.height/2)};else if("right"==f.align)e=e.orientation,g="bottom"==e||"top"==e?{x:Math.round(q-g/2+l.width/2),y:Math.round(d-n+l.height/2)}:{x:Math.round(q-g+l.width/2),y:Math.round(d-n/2+l.height/2)};else throw"align: not implemented";n=a.style;n.left=g.x+"px";n.top=g.y+"px";n.display=this.fitsInCanvas(g,h)?"":"none";c.onPlaceLabel(a,b)}});$jit.ST.Label.SVG=new j({Implements:[$jit.ST.Label.DOM,
k.Label.SVG],initialize:function(a){this.viz=a}});$jit.ST.Label.HTML=new j({Implements:[$jit.ST.Label.DOM,k.Label.HTML],initialize:function(a){this.viz=a}});$jit.ST.Plot.NodeTypes=new j({none:{render:g.empty,contains:g.lambda(!1)},circle:{render:function(a,b){var c=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(!0),c,c),c=c/2;this.nodeHelper.circle.render("fill",{x:d.x+c,y:d.y+c},c,b)},contains:function(a,b){var c=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(!0),c,c),c=c/2;this.nodeHelper.circle.contains({x:d.x+
c,y:d.y+c},b,c)}},square:{render:function(a,b){var c=a.getData("dim"),d=c/2,c=this.getAlignedPos(a.pos.getc(!0),c,c);this.nodeHelper.square.render("fill",{x:c.x+d,y:c.y+d},d,b)},contains:function(a,b){var c=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(!0),c,c),c=c/2;this.nodeHelper.square.contains({x:d.x+c,y:d.y+c},b,c)}},ellipse:{render:function(a,b){var c=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(!0),c,d);this.nodeHelper.ellipse.render("fill",{x:e.x+c/2,y:e.y+
d/2},c,d,b)},contains:function(a,b){var c=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(!0),c,d);this.nodeHelper.ellipse.contains({x:e.x+c/2,y:e.y+d/2},b,c,d)}},rectangle:{render:function(a,b){var c=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(!0),c,d);this.nodeHelper.rectangle.render("fill",{x:e.x+c/2,y:e.y+d/2},c,d,b)},contains:function(a,b){var c=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(!0),c,d);this.nodeHelper.rectangle.contains({x:e.x+
c/2,y:e.y+d/2},b,c,d)}}});$jit.ST.Plot.EdgeTypes=new j({none:g.empty,line:{render:function(a,b){var c=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",c),c=this.viz.geom.getEdge(f?e:d,"end",c);this.edgeHelper.line.render(h,c,b)},contains:function(a,b){var c=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",c),c=this.viz.geom.getEdge(f?e:d,"end",c);return this.edgeHelper.line.contains(h,c,
b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=a.getData("dim"),h=this.viz.geom.getEdge(d,"begin",c),c=this.viz.geom.getEdge(e,"end",c),e=a.data.$direction;this.edgeHelper.arrow.render(h,c,f,e&&1<e.length&&e[0]!=d.id,b)},contains:function(a,b){var c=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",c),c=this.viz.geom.getEdge(f?e:d,"end",c);return this.edgeHelper.arrow.contains(h,c,b,this.edge.epsilon)}},
"quadratic:begin":{render:function(a,b){var c=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",c),d=this.viz.geom.getEdge(f?e:d,"end",c),e=a.getData("dim"),f=b.getCtx();f.beginPath();f.moveTo(h.x,h.y);switch(c){case "left":f.quadraticCurveTo(h.x+e,h.y,d.x,d.y);break;case "right":f.quadraticCurveTo(h.x-e,h.y,d.x,d.y);break;case "top":f.quadraticCurveTo(h.x,h.y+e,d.x,d.y);break;case "bottom":f.quadraticCurveTo(h.x,h.y-e,d.x,d.y)}f.stroke()}},"quadratic:end":{render:function(a,
b){var c=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",c),d=this.viz.geom.getEdge(f?e:d,"end",c),e=a.getData("dim"),f=b.getCtx();f.beginPath();f.moveTo(h.x,h.y);switch(c){case "left":f.quadraticCurveTo(d.x-e,d.y,d.x,d.y);break;case "right":f.quadraticCurveTo(d.x+e,d.y,d.x,d.y);break;case "top":f.quadraticCurveTo(d.x,d.y-e,d.x,d.y);break;case "bottom":f.quadraticCurveTo(d.x,d.y+e,d.x,d.y)}f.stroke()}},bezier:{render:function(a,b){var c=this.getOrientation(a),
d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",c),d=this.viz.geom.getEdge(f?e:d,"end",c),e=a.getData("dim"),f=b.getCtx();f.beginPath();f.moveTo(h.x,h.y);switch(c){case "left":f.bezierCurveTo(h.x+e,h.y,d.x-e,d.y,d.x,d.y);break;case "right":f.bezierCurveTo(h.x-e,h.y,d.x+e,d.y,d.x,d.y);break;case "top":f.bezierCurveTo(h.x,h.y+e,d.x,d.y-e,d.x,d.y);break;case "bottom":f.bezierCurveTo(h.x,h.y-e,d.x,d.y+e,d.x,d.y)}f.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(a,
b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height"),e=this.getAlignedPos(c,d,e),c=e.x,e=e.y,f=a.getData("stringArray"),h=a.getData("dimArray"),m=a.getData("valueArray"),n=g.reduce(m,function(a,b){return a+b[0]},0),l=g.reduce(m,function(a,b){return a+b[1]},0),q=a.getData("colorArray"),s=q.length,p=a.getData("config"),j=a.getData("gradient"),k=p.showLabels,u=p.showAggregates,F=p.Label,K=a.getData("prev"),w=b.getCtx(),r=a.getData("border");if(q&&h&&f){for(var C=0,B=h.length,D=0,A=0,x=
0;C<B;C++){w.fillStyle=w.strokeStyle=q[C%s];w.save();if(j&&(0<h[C][0]||0<h[C][1])){var t=D+h[C][0],v=A+h[C][1],y=Math.atan((v-t)/d),v=w.createLinearGradient(c+d/2,e-(t+v)/2,c+d/2+55*Math.sin(y),e-(t+v)/2+55*Math.cos(y)),t=g.rgbToHex(g.map(g.hexToRgb(q[C%s].slice(1)),function(a){return 0.85*a>>0}));v.addColorStop(0,q[C%s]);v.addColorStop(1,t);w.fillStyle=v}w.beginPath();w.moveTo(c,e-D);w.lineTo(c+d,e-A);w.lineTo(c+d,e-A-h[C][1]);w.lineTo(c,e-D-h[C][0]);w.lineTo(c,e-D);w.fill();w.restore();if(r){var z=
(v=r.name==f[C])?0.7:0.8,t=g.rgbToHex(g.map(g.hexToRgb(q[C%s].slice(1)),function(a){return a*z>>0}));w.strokeStyle=t;w.lineWidth=v?4:1;w.save();w.beginPath();0===r.index?(w.moveTo(c,e-D),w.lineTo(c,e-D-h[C][0])):(w.moveTo(c+d,e-A),w.lineTo(c+d,e-A-h[C][1]));w.stroke();w.restore()}D+=h[C][0]||0;A+=h[C][1]||0;0<h[C][0]&&(x+=m[C][0]||0)}K&&"Native"==F.type&&(w.save(),w.beginPath(),w.fillStyle=w.strokeStyle=F.color,w.font=F.style+" "+F.size+"px "+F.family,w.textAlign="center",w.textBaseline="middle",
f=u(a.name,n,l,a,x),!1!==f&&w.fillText(!0!==f?f:x,c,e-D-p.labelOffset-F.size/2,d),k(a.name,n,l,a)&&w.fillText(a.name,c,e+F.size/2+p.labelOffset),w.restore())}},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height"),c=this.getAlignedPos(c,d,e),f=c.x,h=c.y,c=a.getData("dimArray"),g=b.x-f;if(b.x<f||b.x>f+d||b.y>h||b.y<h-e)return!1;for(var e=0,f=c.length,n=h;e<f;e++){var l=c[e],n=n-l[0],h=h-l[1];if(b.y>=n+(h-n)*g/d)return d=+(g>d/2),{name:a.getData("stringArray")[e],color:a.getData("colorArray")[e],
value:a.getData("valueArray")[e][d],index:d}}return!1}}});$jit.AreaChart=new j({st:null,colors:"#416D9C #70A35E #EBB056 #C74243 #83548B #909291 #557EAA".split(" "),selected:{},busy:!1,initialize:function(a){this.controller=this.config=g.merge(v("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},a);a=this.config.showLabels;var b=g.type(a),c=this.config.showAggregates,d=g.type(c);this.config.showLabels="function"==b?a:g.lambda(a);this.config.showAggregates="function"==d?c:g.lambda(c);this.initializeViz()},
initializeViz:function(){var a=this.config,b=this,c=a.type.split(":")[0],d={},c=new $jit.ST({injectInto:a.injectInto,width:a.width,height:a.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:"Native"!=a.Label.type,useCanvas:a.useCanvas,Label:{type:a.Label.type},Node:{overridable:!0,type:"areachart-"+c,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:!0,onShow:function(b,c,d){a.Tips.onShow(b,d,c)}},Events:{enable:!0,
type:"Native",onClick:function(c,d,e){if(a.filterOnClick||a.Events.enable)(c=d.getContains())&&a.filterOnClick&&b.filter(c.name),a.Events.enable&&a.Events.onClick(c,d,e)},onRightClick:function(){a.restoreOnRightClick&&b.restore()},onMouseMove:function(c,d){if(a.selectOnHover)if(c){var e=d.getContains();b.select(c.id,e.name,e.index)}else b.select(!1,!1,!1)}},onCreateLabel:function(b,c){var e=a.Label,f=c.getData("valueArray"),q=g.reduce(f,function(a,b){return a+b[0]},0),f=g.reduce(f,function(a,b){return a+
b[1]},0);if(c.getData("prev")){var s={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},p=s.wrapper,j=s.label,k=s.aggregate,u=p.style,F=j.style,K=k.style;d[c.id]=s;p.appendChild(j);p.appendChild(k);a.showLabels(c.name,q,f,c)||(j.style.display="none");a.showAggregates(c.name,q,f,c)||(k.style.display="none");u.position="relative";u.overflow="visible";u.fontSize=e.size+"px";u.fontFamily=e.family;u.color=e.color;u.textAlign="center";K.position=
F.position="absolute";b.style.width=c.getData("width")+"px";b.style.height=c.getData("height")+"px";j.innerHTML=c.name;b.appendChild(p)}},onPlaceLabel:function(b,c){if(c.getData("prev")){var e=d[c.id],f=e.wrapper.style,q=e.label.style,s=e.aggregate.style,p=c.getData("width");c.getData("height");var j=c.getData("dimArray"),k=c.getData("valueArray"),u=g.reduce(k,function(a,b){return a+b[0]},0),F=g.reduce(k,function(a,b){return a+b[1]},0),K=parseInt(f.fontSize,10);if(j&&k){q.display=a.showLabels(c.name,
u,F,c)?"":"none";u=a.showAggregates(c.name,u,F,c);s.display=!1!==u?"":"none";f.width=s.width=q.width=b.style.width=p+"px";s.left=q.left=-p/2+"px";for(var p=0,F=k.length,w=0,r=0;p<F;p++)0<j[p][0]&&(w+=k[p][0],r+=j[p][0]);s.top=-K-a.labelOffset+"px";q.top=a.labelOffset+r+"px";b.style.top=parseInt(b.style.top,10)-r+"px";b.style.height=f.height=r+"px";e.aggregate.innerHTML=!0!==u?u:w}}}}),e=c.canvas.getSize(),f=a.Margin;c.config.offsetY=-e.height/2+f.bottom+(a.showLabels&&a.labelOffset+a.Label.size);
c.config.offsetX=(f.right-f.left)/2;this.delegate=c;this.canvas=this.delegate.canvas},loadJSON:function(a){var b=g.time(),c=[],d=this.delegate,e=g.splat(a.label),f=g.splat(a.color||this.colors),h=this.config,m=!!h.type.split(":")[1],n=h.animate,l=0;a=a.values;for(var q=a.length;l<q-1;l++){var s=a[l],p=a[l-1],j=a[l+1],k=g.splat(a[l].values),u=g.splat(a[l+1].values),k=g.zip(k,u);c.push({id:b+s.label,name:s.label,data:{value:k,$valueArray:k,$colorArray:f,$stringArray:e,$next:j.label,$prev:p?p.label:
!1,$config:h,$gradient:m},children:[]})}d.loadJSON({id:b+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:c});this.normalizeDims();d.compute();d.select(d.root);n&&d.fx.animate({modes:["node-property:height:dimArray"],duration:1500})},updateJSON:function(a,b){if(!this.busy){this.busy=!0;for(var c=this.delegate,d=c.graph,e=a.label&&g.splat(a.label),f=a.values,h=this.config.animate,m=this,n={},l=0,q=f.length;l<q;l++)n[f[l].label]=f[l];d.eachNode(function(a){var b=n[a.name],c=a.getData("stringArray"),
d=a.getData("valueArray"),f=a.getData("next");b&&(b.values=g.splat(b.values),g.each(d,function(a,d){a[0]=b.values[d];e&&(c[d]=e[d])}),a.setData("valueArray",d));f&&(b=n[f])&&g.each(d,function(a,c){a[1]=b.values[c]})});this.normalizeDims();c.compute();c.select(c.root);h&&c.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){m.busy=!1;b&&b.onComplete()}})}},filter:function(a,b){if(!this.busy){this.busy=!0;this.config.Tips.enable&&this.delegate.tips.hide();this.select(!1,
!1,!1);var c=g.splat(a),d=this.delegate.graph.getNode(this.delegate.root),e=this;this.normalizeDims();d.eachAdjacency(function(a){a=a.nodeTo;var b=a.getData("dimArray","end"),d=a.getData("stringArray");a.setData("dimArray",g.map(b,function(a,b){return-1<g.indexOf(c,d[b])?a:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){e.busy=!1;b&&b.onComplete()}})}},restore:function(a){if(!this.busy){this.busy=!0;this.config.Tips.enable&&this.delegate.tips.hide();
this.select(!1,!1,!1);this.normalizeDims();var b=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){b.busy=!1;a&&a.onComplete()}})}},select:function(a,b,c){if(this.config.selectOnHover){var d=this.selected;if(d.id!=a||d.name!=b||d.index!=c){d.id=a;d.name=b;d.index=c;this.delegate.graph.eachNode(function(a){a.setData("border",!1)});if(a&&(a=this.delegate.graph.getNode(a),a.setData("border",d),d=a.getData(0===c?"prev":"next")))(a=this.delegate.graph.getByName(d))&&
a.setData("border",{name:b,index:1-c});this.delegate.plot()}}},getLegend:function(){var a={},b;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(a){b=a.nodeTo});var c=b.getData("colorArray"),d=c.length;g.each(b.getData("stringArray"),function(b,f){a[b]=c[f%d]});return a},getMaxValue:function(){var a=0;this.delegate.graph.eachNode(function(b){b=b.getData("valueArray");var c=0,d=0;g.each(b,function(a){c+=+a[0];d+=+a[1]});b=d>c?d:c;a=a>b?a:b});return a},normalizeDims:function(){var a=
0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){a++});var b=this.getMaxValue()||1,c=this.delegate.canvas.getSize(),d=this.config,e=d.Margin,f=d.labelOffset+d.Label.size,h=(c.width-(e.left+e.right))/a,m=d.animate,n=c.height-(e.top+e.bottom)-(d.showAggregates&&f)-(d.showLabels&&f);this.delegate.graph.eachNode(function(a){var c=0,d=0,e=[];g.each(a.getData("valueArray"),function(a){c+=+a[0];d+=+a[1];e.push([0,0])});var f=d>c?d:c;a.setData("width",h);m?(a.setData("height",f*
n/b,"end"),a.setData("dimArray",g.map(a.getData("valueArray"),function(a){return[a[0]*n/b,a[1]*n/b]}),"end"),a.getData("dimArray")||a.setData("dimArray",e)):(a.setData("height",f*n/b),a.setData("dimArray",g.map(a.getData("valueArray"),function(a){return[a[0]*n/b,a[1]*n/b]})))})}});v.BarChart={$extend:!0,animate:!0,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:!0,showLabels:!0,Tips:{enable:!1,onShow:g.empty,onHide:g.empty},Events:{enable:!1,
onClick:g.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(c,d,e),c=f.x,f=f.y,h=a.getData("dimArray"),m=a.getData("valueArray"),n=a.getData("colorArray"),l=n.length,q=a.getData("stringArray"),s=b.getCtx(),p,j,k=a.getData("border"),u=a.getData("gradient"),F=a.getData("config"),r="horizontal"==F.orientation,w=F.showAggregates,x=F.showLabels,C=F.Label;if(n&&h&&q){for(var B=0,D=h.length,
A=0,t=0;B<D;B++){s.fillStyle=s.strokeStyle=n[B%l];if(u){var v;v=r?s.createLinearGradient(c+A+h[B]/2,f,c+A+h[B]/2,f+e):s.createLinearGradient(c,f-A-h[B]/2,c+d,f-A-h[B]/2);var y=g.rgbToHex(g.map(g.hexToRgb(n[B%l].slice(1)),function(a){return 0.5*a>>0}));v.addColorStop(0,y);v.addColorStop(0.5,n[B%l]);v.addColorStop(1,y);s.fillStyle=v}r?s.fillRect(c+A,f,h[B],e):s.fillRect(c,f-A-h[B],d,h[B]);k&&k.name==q[B]&&(p=A,j=h[B]);A+=h[B]||0;t+=m[B]||0}k&&(s.save(),s.lineWidth=2,s.strokeStyle=k.color,r?s.strokeRect(c+
p+1,f+1,j-2,e-2):s.strokeRect(c+1,f-p-j+1,d-2,j-2),s.restore());"Native"==C.type&&(s.save(),s.fillStyle=s.strokeStyle=C.color,s.font=C.style+" "+C.size+"px "+C.family,s.textBaseline="middle",p=w(a.name,t,a),!1!==p&&(p=!0!==p?p:t,r?(s.textAlign="right",s.fillText(p,c+A-F.labelOffset,f+e/2)):(s.textAlign="center",s.fillText(p,c+d/2,f-e-C.size/2-F.labelOffset))),x(a.name,t,a)&&(r?(s.textAlign="center",s.translate(c-F.labelOffset-C.size/2,f+e/2),s.rotate(Math.PI/2),s.fillText(a.name,0,0)):(s.textAlign=
"center",s.fillText(a.name,c+d/2,f+C.size/2+F.labelOffset))),s.restore())}},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height"),c=this.getAlignedPos(c,d,e),f=c.x,h=c.y,c=a.getData("dimArray"),g="horizontal"==a.getData("config").orientation;if(g){if(b.x<f||b.x>f+d||b.y>h+e||b.y<h)return!1}else if(b.x<f||b.x>f+d||b.y>h||b.y<h-e)return!1;d=0;e=c.length;for(f=g?f:h;d<e;d++)if(h=c[d],g){if(h=f+=h,b.x<=h)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],
value:a.getData("valueArray")[d],label:a.name}}else if(h=f-=h,b.y>=h)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],label:a.name};return!1}},"barchart-grouped":{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(c,d,e),c=f.x,f=f.y,h=a.getData("dimArray"),m=a.getData("valueArray"),n=m.length,l=a.getData("colorArray"),q=l.length,s=a.getData("stringArray"),p=b.getCtx(),j,k,u=a.getData("border"),
r=a.getData("gradient"),t=a.getData("config"),w="horizontal"==t.orientation,v=t.showAggregates,x=t.showLabels,B=t.Label,D=(w?e:d)/n;if(l&&h&&s){for(var A=0,y=0;A<n;A++){p.fillStyle=p.strokeStyle=l[A%q];if(r){var z;z=w?p.createLinearGradient(c+h[A]/2,f+D*A,c+h[A]/2,f+D*(A+1)):p.createLinearGradient(c+D*A,f-h[A]/2,c+D*(A+1),f-h[A]/2);var E=g.rgbToHex(g.map(g.hexToRgb(l[A%q].slice(1)),function(a){return 0.5*a>>0}));z.addColorStop(0,E);z.addColorStop(0.5,l[A%q]);z.addColorStop(1,E);p.fillStyle=z}w?p.fillRect(c,
f+D*A,h[A],D):p.fillRect(c+D*A,f-h[A],D,h[A]);u&&u.name==s[A]&&(j=D*A,k=h[A]);y+=m[A]||0}u&&(p.save(),p.lineWidth=2,p.strokeStyle=u.color,w?p.strokeRect(c+1,f+j+1,k-2,D-2):p.strokeRect(c+j+1,f-k+1,D-2,k-2),p.restore());"Native"==B.type&&(p.save(),p.fillStyle=p.strokeStyle=B.color,p.font=B.style+" "+B.size+"px "+B.family,p.textBaseline="middle",j=v(a.name,y,a),!1!==j&&(j=!0!==j?j:y,w?(p.textAlign="right",p.fillText(j,c+Math.max.apply(null,h)-t.labelOffset,f+e/2)):(p.textAlign="center",p.fillText(j,
c+d/2,f-Math.max.apply(null,h)-B.size/2-t.labelOffset))),x(a.name,y,a)&&(w?(p.textAlign="center",p.translate(c-t.labelOffset-B.size/2,f+e/2),p.rotate(Math.PI/2),p.fillText(a.name,0,0)):(p.textAlign="center",p.fillText(a.name,c+d/2,f+B.size/2+t.labelOffset))),p.restore())}},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(c,d,e),c=f.x,f=f.y,h=a.getData("dimArray"),g=h.length,n="horizontal"==a.getData("config").orientation,g=(n?e:d)/g;if(n){if(b.x<
c||b.x>c+d||b.y>f+e||b.y<f)return!1}else if(b.x<c||b.x>c+d||b.y>f||b.y<f-e)return!1;d=0;for(e=h.length;d<e;d++){var l=h[d];if(n){var q=f+g*d;if(b.x<=c+l&&b.y>=q&&b.y<=q+g)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],label:a.name}}else if(q=c+g*d,b.x>=q&&b.x<=q+g&&b.y>=f-l)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],label:a.name}}return!1}}});$jit.BarChart=new j({st:null,colors:"#416D9C #70A35E #EBB056 #C74243 #83548B #909291 #557EAA".split(" "),
selected:{},busy:!1,initialize:function(a){this.controller=this.config=g.merge(v("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},a);a=this.config.showLabels;var b=g.type(a),c=this.config.showAggregates,d=g.type(c);this.config.showLabels="function"==b?a:g.lambda(a);this.config.showAggregates="function"==d?c:g.lambda(c);this.initializeViz()},initializeViz:function(){var a=this.config,b=this,c=a.type.split(":")[0],d="horizontal"==a.orientation,e={},c=new $jit.ST({injectInto:a.injectInto,
width:a.width,height:a.height,orientation:d?"left":"bottom",levelDistance:0,siblingOffset:a.barsOffset,subtreeOffset:0,withLabels:"Native"!=a.Label.type,useCanvas:a.useCanvas,Label:{type:a.Label.type},Node:{overridable:!0,type:"barchart-"+c,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:!0,onShow:function(b,c,d){a.Tips.onShow(b,d,c)}},Events:{enable:!0,type:"Native",onClick:function(b,c,d){a.Events.enable&&(b=c.getContains(),a.Events.onClick(b,c,d))},
onMouseMove:function(c,d){if(a.hoveredColor)if(c){var e=d.getContains();b.select(c.id,e.name,e.index)}else b.select(!1,!1,!1)}},onCreateLabel:function(b,c){var d=a.Label,f=c.getData("valueArray"),f=g.reduce(f,function(a,b){return a+b},0),h={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},p=h.wrapper,j=h.label,k=h.aggregate,u=p.style,r=j.style,t=k.style;e[c.id]=h;p.appendChild(j);p.appendChild(k);a.showLabels(c.name,f,c)||(r.display=
"none");a.showAggregates(c.name,f,c)||(t.display="none");u.position="relative";u.overflow="visible";u.fontSize=d.size+"px";u.fontFamily=d.family;u.color=d.color;u.textAlign="center";t.position=r.position="absolute";b.style.width=c.getData("width")+"px";b.style.height=c.getData("height")+"px";t.left=r.left="0px";j.innerHTML=c.name;b.appendChild(p)},onPlaceLabel:function(b,c){if(e[c.id]){var d=e[c.id],f=d.wrapper.style,h=d.label.style,g=d.aggregate.style,j="grouped"==a.type.split(":")[0],k="horizontal"==
a.orientation,u=c.getData("dimArray"),r=c.getData("valueArray"),t=j&&k?Math.max.apply(null,u):c.getData("width"),j=j&&!k?Math.max.apply(null,u):c.getData("height"),k=parseInt(f.fontSize,10);if(u&&r){f.width=g.width=h.width=b.style.width=t+"px";for(var w=0,v=r.length,t=0;w<v;w++)0<u[w]&&(t+=r[w]);h.display=a.showLabels(c.name,t,c)?"":"none";u=a.showAggregates(c.name,t,c);g.display=!1!==u?"":"none";"horizontal"==a.orientation?(g.textAlign="right",h.textAlign="left",h.textIndex=g.textIndent=a.labelOffset+
"px",g.top=h.top=(j-k)/2+"px"):(g.top=-k-a.labelOffset+"px",h.top=a.labelOffset+j+"px",b.style.top=parseInt(b.style.top,10)-j+"px");b.style.height=f.height=j+"px";d.aggregate.innerHTML=!0!==u?u:t}}}}),f=c.canvas.getSize(),h=a.Margin;d?(c.config.offsetX=f.width/2-h.left-(a.showLabels&&a.labelOffset+a.Label.size),c.config.offsetY=(h.bottom-h.top)/2):(c.config.offsetY=-f.height/2+h.bottom+(a.showLabels&&a.labelOffset+a.Label.size),c.config.offsetX=(h.right-h.left)/2);this.delegate=c;this.canvas=this.delegate.canvas},
loadJSON:function(a){if(!this.busy){this.busy=!0;var b=g.time(),c=[],d=this.delegate,e=g.splat(a.label),f=g.splat(a.color||this.colors),h=this.config,m=!!h.type.split(":")[1],n=h.animate,l="horizontal"==h.orientation,q=this,j=0;a=a.values;for(var p=a.length;j<p;j++){var k=a[j],r=g.splat(a[j].values);c.push({id:b+k.label,name:k.label,data:{value:r,$valueArray:r,$colorArray:f,$stringArray:e,$gradient:m,$config:h},children:[]})}d.loadJSON({id:b+"$root",name:"",data:{$type:"none",$width:1,$height:1},
children:c});this.normalizeDims();d.compute();d.select(d.root);n?l?d.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){q.busy=!1}}):d.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){q.busy=!1}}):this.busy=!1}},updateJSON:function(a,b){if(!this.busy){this.busy=!0;this.select(!1,!1,!1);var c=this.delegate,d=c.graph,e=this.config.animate,f=this,h="horizontal"==this.config.orientation;g.each(a.values,function(b){var c=d.getByName(b.label);
c&&(c.setData("valueArray",g.splat(b.values)),a.label&&c.setData("stringArray",g.splat(a.label)))});this.normalizeDims();c.compute();c.select(c.root);e&&(h?c.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){f.busy=!1;b&&b.onComplete()}}):c.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){f.busy=!1;b&&b.onComplete()}}))}},select:function(a,b){if(this.config.hoveredColor){var c=this.selected;if(c.id!=a||c.name!=b)c.id=a,c.name=
b,c.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(b){a==b.id?b.setData("border",c):b.setData("border",!1)}),this.delegate.plot()}},getLegend:function(){var a={},b;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(a){b=a.nodeTo});var c=b.getData("colorArray"),d=c.length;g.each(b.getData("stringArray"),function(b,f){a[b]=c[f%d]});return a},getMaxValue:function(){var a=0,b="stacked"==this.config.type.split(":")[0];this.delegate.graph.eachNode(function(c){c=
c.getData("valueArray");var d=0;c&&(b?g.each(c,function(a){d+=+a}):d=Math.max.apply(null,c),a=a>d?a:d)});return a},setBarType:function(a){this.config.type=a;this.delegate.config.Node.type="barchart-"+a.split(":")[0]},normalizeDims:function(){var a=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){a++});var b=this.getMaxValue()||1,c=this.delegate.canvas.getSize(),d=this.config,e=d.Margin,f=e.left+e.right,e=e.top+e.bottom,h="horizontal"==d.orientation,m=(c[h?"height":"width"]-
(h?e:f)-(a-1)*d.barsOffset)/a,n=d.animate,l=c[h?"width":"height"]-(h?f:e)-(!h&&d.showAggregates&&d.Label.size+d.labelOffset)-(d.showLabels&&d.Label.size+d.labelOffset),q=h?"height":"width",j=h?"width":"height";this.delegate.graph.eachNode(function(a){var c=0,d=[];g.each(a.getData("valueArray"),function(a){c+=+a;d.push(0)});a.setData(q,m);n?(a.setData(j,c*l/b,"end"),a.setData("dimArray",g.map(a.getData("valueArray"),function(a){return a*l/b}),"end"),a.getData("dimArray")||a.setData("dimArray",d)):
(a.setData(j,c*l/b),a.setData("dimArray",g.map(a.getData("valueArray"),function(a){return a*l/b})))})}});v.PieChart={$extend:!0,animate:!0,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:!1,onClick:g.empty},Tips:{enable:!1,onShow:g.empty,onHide:g.empty},showLabels:!0,resizeLabels:!1,updateHeights:!1};y.Radial=new j({compute:function(a){a=g.splat(a||["current","start","end"]);X.compute(this.graph,a,this.config);this.graph.computeLevels(this.root,0,"ignore");
var b=this.createLevelDistanceFunc();this.computeAngularWidths(a);this.computePositions(a,b)},computePositions:function(a,b){for(var c=this.graph,d=c.getNode(this.root),e=this.parent,f=0,h=a.length;f<h;f++){var g=a[f];d.setPos(new E(0,0),g);d.setData("span",2*Math.PI,g)}d.angleSpan={begin:0,end:2*Math.PI};c.eachBFS(this.root,function(c){var d=c.angleSpan.end-c.angleSpan.begin,f=c.angleSpan.begin,h=b(c),g=0,m=[],j={};c.eachSubnode(function(b){g+=b._treeAngularWidth;for(var c=0,d=a.length;c<d;c++){var e=
a[c],f=b.getData("dim",e);j[e]=e in j?f>j[e]?f:j[e]:f}m.push(b)},"ignore");e&&(e.id==c.id&&0<m.length&&m[0].dist)&&m.sort(function(a,b){return(a.dist>=b.dist)-(a.dist<=b.dist)});c=0;for(var k=m.length;c<k;c++){var r=m[c];if(!r._flag){for(var t=r._treeAngularWidth/g*d,w=f+t/2,v=0,x=a.length;v<x;v++){var B=a[v];r.setPos(new E(w,h),B);r.setData("span",t,B);r.setData("dim-quotient",r.getData("dim",B)/j[B],B)}r.angleSpan={begin:f,end:f+t};f+=t}}},"ignore")},setAngularWidthForNodes:function(a){this.graph.eachBFS(this.root,
function(b,c){var d=b.getData("angularWidth",a[0])||5;b._angularWidth=d/c},"ignore")},setSubtreesAngularWidth:function(){var a=this;this.graph.eachNode(function(b){a.setSubtreeAngularWidth(b)},"ignore")},setSubtreeAngularWidth:function(a){var b=this,c=a._angularWidth,d=0;a.eachSubnode(function(a){b.setSubtreeAngularWidth(a);d+=a._treeAngularWidth},"ignore");a._treeAngularWidth=Math.max(c,d)},computeAngularWidths:function(a){this.setAngularWidthForNodes(a);this.setSubtreesAngularWidth()}});$jit.Sunburst=
new j({Implements:[x,H,y.Radial],initialize:function(a){var b=$jit.Sunburst;a=this.controller=this.config=g.merge(v("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}},a);a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(a.background&&(a.background=g.merge({type:"Circles"},a.background)),
this.canvas=new G(this,a),this.config.labelContainer=("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:E,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new k(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new b.Label[a.Label.type](this);this.fx=new b.Plot(this,b);this.op=new b.Op(this);this.rotated=this.root=this.json=null;this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;return function(b){return(b._depth+
1)*a}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(a,b,c){var d=a.getPos(c.property||"current").getp(!0).theta;this.rotated=a;this.rotateAngle(-d,b,c)},rotateAngle:function(a,b,c){var d=g.merge(this.config,c||{},{modes:["polar"]}),e=c.property||("animate"===b?"end":"current");"animate"===b&&this.fx.animation.pause();this.graph.eachNode(function(b){b=b.getPos(e);b.theta+=a;0>b.theta&&(b.theta+=2*Math.PI)});"animate"==b?this.fx.animate(d):
"replot"==b&&(this.fx.plot(),this.busy=!1)},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=!0;r=$jit.Sunburst;r.Op=new j({Implements:k.Op});r.Plot=new j({Implements:k.Plot});r.Label={};r.Label.Native=new j({Implements:k.Label.Native,initialize:function(a){this.viz=a;this.label=a.config.Label;this.config=a.config},renderLabel:function(a,b){var c=b.getData("span");if(!(c<Math.PI/2&&10>Math.tan(c)*this.config.levelDistance*b._depth)){var c=a.getCtx(),d=c.measureText(b.name);if(b.id==this.viz.root)var e=
-d.width/2,f=0,h=0;else{e=b.pos.clone();e.rho+=5;var g=e.getp(!0),f=e.getc(!0),e=f.x,f=f.y,h=Math.PI,n=g.theta>h/2&&g.theta<3*h/2,h=n?g.theta+h:g.theta;n?(e-=Math.abs(Math.cos(g.theta)*d.width),f+=Math.sin(g.theta)*d.width):b.id==this.viz.root&&(e-=d.width/2)}c.save();c.translate(e,f);c.rotate(h);c.fillText(b.name,0,0);c.restore()}}});r.Label.SVG=new j({Implements:k.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz,f=this.viz.canvas.getSize(),
h=Math.round(d.x+f.width/2),d=Math.round(d.y+f.height/2);a.setAttribute("x",h);a.setAttribute("y",d);var g=a.getBBox();if(g){var h=a.getAttribute("x"),d=a.getAttribute("y"),n=b.pos.getp(!0),f=Math.PI,l=n.theta>f/2&&n.theta<3*f/2;l?(a.setAttribute("x",h-g.width),a.setAttribute("y",d-g.height)):b.id==e.root&&a.setAttribute("x",h-g.width/2);e=l?n.theta+f:n.theta;b._depth&&a.setAttribute("transform","rotate("+360*e/(2*f)+" "+h+" "+d+")")}c.onPlaceLabel(a,b)}});r.Label.HTML=new j({Implements:k.Label.HTML,
initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.clone(),e=this.viz.canvas,f=b.getData("height"),f=(f||0==b._depth?f:this.viz.config.levelDistance)/2,h=e.getSize();d.rho+=f;d=d.getc(!0);d={x:Math.round(d.x+h.width/2),y:Math.round(d.y+h.height/2)};f=a.style;f.left=d.x+"px";f.top=d.y+"px";f.display=this.fitsInCanvas(d,e)?"":"none";c.onPlaceLabel(a,b)}});r.Plot.NodeTypes=new j({none:{render:g.empty,contains:g.lambda(!1),anglecontains:function(a,b){var c=a.getData("span")/2,d=
a.pos.theta,e=d-c,c=d+c;0>e&&(e+=2*Math.PI);d=Math.atan2(b.y,b.x);0>d&&(d+=2*Math.PI);return e>c?d>e&&d<=2*Math.PI||d<c:d>e&&d<c}},pie:{render:function(a,b){var c=a.getData("span")/2,d=a.pos.theta,e=d-c,c=d+c,d=a.pos.getp(!0),f=new E(d.rho,e),h=f.getc(!0);f.theta=c;var f=f.getc(!0),g=b.getCtx();g.beginPath();g.moveTo(0,0);g.lineTo(h.x,h.y);g.moveTo(0,0);g.lineTo(f.x,f.y);g.moveTo(0,0);g.arc(0,0,d.rho*a.getData("dim-quotient"),e,c,!1);g.fill()},contains:function(a,b){return this.nodeTypes.none.anglecontains.call(this,
a,b)?Math.sqrt(b.x*b.x+b.y*b.y)<=this.config.levelDistance*a._depth:!1}},multipie:{render:function(a,b){var c=a.getData("height"),c=c?c:this.config.levelDistance,d=a.getData("span")/2,e=a.pos.theta,f=e-d,d=e+d,e=a.pos.getp(!0),h=new E(e.rho,f),g=h.getc(!0);h.theta=d;var n=h.getc(!0);h.rho+=c;var l=h.getc(!0);h.theta=f;var h=h.getc(!0),j=b.getCtx();j.moveTo(0,0);j.beginPath();j.arc(0,0,e.rho,f,d,!1);j.arc(0,0,e.rho+c,d,f,!0);j.moveTo(g.x,g.y);j.lineTo(h.x,h.y);j.moveTo(n.x,n.y);j.lineTo(l.x,l.y);j.fill();
a.collapsed&&(j.save(),j.lineWidth=2,j.moveTo(0,0),j.beginPath(),j.arc(0,0,e.rho+c+5,d-0.01,f+0.01,!0),j.stroke(),j.restore())},contains:function(a,b){if(this.nodeTypes.none.anglecontains.call(this,a,b)){var c=Math.sqrt(b.x*b.x+b.y*b.y),d=a.getData("height"),d=d?d:this.config.levelDistance,e=this.config.levelDistance,f=a._depth;return c>=e*f&&c<=e*f+d}return!1}},"gradient-multipie":{render:function(a,b){var c=b.getCtx(),d=a.getData("height"),d=d?d:this.config.levelDistance,d=c.createRadialGradient(0,
0,a.getPos().rho,0,0,a.getPos().rho+d),e=g.hexToRgb(a.getData("color")),f=[];g.each(e,function(a){f.push(parseInt(0.5*a,10))});e=g.rgbToHex(f);d.addColorStop(0,e);d.addColorStop(1,a.getData("color"));c.fillStyle=d;this.nodeTypes.multipie.render.call(this,a,b)},contains:function(a,b){return this.nodeTypes.multipie.contains.call(this,a,b)}},"gradient-pie":{render:function(a,b){var c=b.getCtx(),d=c.createRadialGradient(0,0,0,0,0,a.getPos().rho),e=g.hexToRgb(a.getData("color")),f=[];g.each(e,function(a){f.push(parseInt(0.5*
a,10))});e=g.rgbToHex(f);d.addColorStop(1,e);d.addColorStop(0,a.getData("color"));c.fillStyle=d;this.nodeTypes.pie.render.call(this,a,b)},contains:function(a,b){return this.nodeTypes.pie.contains.call(this,a,b)}}});r.Plot.EdgeTypes=new j({none:g.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);this.edgeHelper.line.render(c,d,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(c,d,b,this.edge.epsilon)}},
arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.getData("dim"),f=a.data.$direction;this.edgeHelper.arrow.render(c,d,e,f&&1<f.length&&f[0]!=a.nodeFrom.id,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(c,d,b,this.edge.epsilon)}},hyperline:{render:function(a,b){var c=a.nodeFrom.pos.getc(),d=a.nodeTo.pos.getc(),e=Math.max(c.norm(),d.norm());this.edgeHelper.hyperline.render(c.$scale(1/e),d.$scale(1/
e),e,b)},contains:g.lambda(!1)}});$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(a,b){a.pos.getp(!0);var c=a.getData("dimArray");a.getData("valueArray");var d=a.getData("colorArray"),e=d.length,f=a.getData("stringArray"),h=a.getData("span")/2,m=a.pos.theta,n=m-h,l=m+h,m=new E,h=b.getCtx(),j,k,p,r,t=a.getData("gradient"),u=a.getData("border"),v=a.getData("config"),x=v.showLabels,w=v.resizeLabels,y=v.Label,C=v.sliceOffset*Math.cos((n+l)/2),B=v.sliceOffset*Math.sin((n+l)/
2);if(d&&c&&f){for(var D=0,A=c.length,z=0;D<A;D++){var G=c[D],H=d[D%e];if(!(0>=G)){h.fillStyle=h.strokeStyle=H;if(t&&G){var L=h.createRadialGradient(C,B,z+v.sliceOffset,C,B,z+G+v.sliceOffset),J=g.hexToRgb(H),J=g.map(J,function(a){return 0.8*a>>0}),J=g.rgbToHex(J);L.addColorStop(0,H);L.addColorStop(0.5,H);L.addColorStop(1,J);h.fillStyle=L}m.rho=z+v.sliceOffset;m.theta=n;m.getc(!0);m.theta=l;m.getc(!0);m.rho+=G;m.getc(!0);m.theta=n;m.getc(!0);h.beginPath();h.arc(C,B,z+0.01,n,l,!1);h.arc(C,B,z+G+0.01,
l,n,!0);h.fill();u&&u.name==f[D]&&(j=z,k=c[D],p=n,r=l);z+=G||0}}u&&(h.save(),h.globalCompositeOperation="source-over",h.lineWidth=2,h.strokeStyle=u.color,h.beginPath(),h.arc(C,B,j+0.01+1,p,r,!1),h.arc(C,B,j+k+0.01-1,r,p,!0),h.closePath(),h.stroke(),h.restore());x&&"Native"==y.type&&(h.save(),h.fillStyle=h.strokeStyle=y.color,c=w?a.getData("normalizedDim"):1,c=y.size*c>>0,h.font=y.style+" "+(c<+w?+w:c)+"px "+y.family,h.textBaseline="middle",h.textAlign="center",m.rho=z+v.labelOffset+v.sliceOffset,
m.theta=a.pos.theta,c=m.getc(!0),h.fillText(a.name,c.x,c.y),h.restore())}},contains:function(a,b){if(this.nodeTypes.none.anglecontains.call(this,a,b)){var c=Math.sqrt(b.x*b.x+b.y*b.y),d=this.config.levelDistance,e=a._depth,f=a.getData("config");if(c<=d*e+f.sliceOffset)for(var d=a.getData("dimArray"),e=0,h=d.length,f=f.sliceOffset;e<h;e++){var g=d[e];if(c>=f&&c<=f+g)return{name:a.getData("stringArray")[e],color:a.getData("colorArray")[e],value:a.getData("valueArray")[e],label:a.name};f+=g}}return!1}}});
$jit.PieChart=new j({sb:null,colors:"#416D9C #70A35E #EBB056 #C74243 #83548B #909291 #557EAA".split(" "),selected:{},busy:!1,initialize:function(a){this.controller=this.config=g.merge(v("Canvas","PieChart","Label"),{Label:{type:"Native"}},a);this.initializeViz()},initializeViz:function(){var a=this.config,b=this,c=a.type.split(":")[0],c=new $jit.Sunburst({injectInto:a.injectInto,width:a.width,height:a.height,useCanvas:a.useCanvas,withLabels:"Native"!=a.Label.type,Label:{type:a.Label.type},Node:{overridable:!0,
type:"piechart-"+c,width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:!0,onShow:function(b,c,d){a.Tips.onShow(b,d,c)}},Events:{enable:!0,type:"Native",onClick:function(b,c,d){a.Events.enable&&(b=c.getContains(),a.Events.onClick(b,c,d))},onMouseMove:function(c,d){if(a.hoveredColor)if(c){var e=d.getContains();b.select(c.id,e.name,e.index)}else b.select(!1,!1,!1)}},onCreateLabel:function(b,c){var d=a.Label;if(a.showLabels){var e=b.style;e.fontSize=d.size+"px";e.fontFamily=
d.family;e.color=d.color;e.textAlign="center";b.innerHTML=c.name}},onPlaceLabel:function(c,d){if(a.showLabels){var e=d.pos.getp(!0),e=d.getData("dimArray"),g=d.getData("span")/2,j=d.pos.theta,q=j-g,g=j+g,j=new E,k=a.resizeLabels,p=a.Label;if(e){for(var r=0,t=e.length,u=0;r<t;r++)u+=e[r];e=k?d.getData("normalizedDim"):1;e=p.size*e>>0;c.style.fontSize=(e<+k?+k:e)+"px";j.rho=u+a.labelOffset+a.sliceOffset;j.theta=(q+g)/2;e=j.getc(!0);g=b.canvas.getSize();q=Math.round(e.x+g.width/2);e=Math.round(e.y+g.height/
2);c.style.left=q+"px";c.style.top=e+"px"}}}}),d=c.canvas.getSize(),e=Math.min;c.config.levelDistance=e(d.width,d.height)/2-a.offset-a.sliceOffset;this.delegate=c;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(a){var b=g.time(),c=[],d=this.delegate,e=g.splat(a.label),f=e.length,h=g.splat(a.color||this.colors),m=h.length,j=this.config,l=!!j.type.split(":")[1],q=j.animate,f=1==f,k=0;a=a.values;for(var p=a.length;k<p;k++){var r=a[k],t=g.splat(r.values);
c.push({id:b+r.label,name:r.label,data:{value:t,$valueArray:t,$colorArray:f?g.splat(h[k%m]):h,$stringArray:e,$gradient:l,$config:j,$angularWidth:g.reduce(t,function(a,b){return a+b})},children:[]})}d.loadJSON({id:b+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:c});this.normalizeDims();d.refresh();q&&d.fx.animate({modes:["node-property:dimArray"],duration:1500})},updateJSON:function(a,b){if(!this.busy){this.busy=!0;var c=this.delegate,d=c.graph,e=this.config.animate,f=this;g.each(a.values,
function(b){var c=d.getByName(b.label);b=g.splat(b.values);c&&(c.setData("valueArray",b),c.setData("angularWidth",g.reduce(b,function(a,b){return a+b})),a.label&&c.setData("stringArray",g.splat(a.label)))});this.normalizeDims();e?(c.compute("end"),c.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){f.busy=!1;b&&b.onComplete()}})):c.refresh()}},select:function(a,b){if(this.config.hoveredColor){var c=this.selected;if(c.id!=a||c.name!=b)c.id=a,c.name=b,c.color=
this.config.hoveredColor,this.delegate.graph.eachNode(function(b){a==b.id?b.setData("border",c):b.setData("border",!1)}),this.delegate.plot()}},getLegend:function(){var a={},b;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(a){b=a.nodeTo});var c=b.getData("colorArray"),d=c.length;g.each(b.getData("stringArray"),function(b,f){a[b]=c[f%d]});return a},getMaxValue:function(){var a=0;this.delegate.graph.eachNode(function(b){b=b.getData("valueArray");var c=0;g.each(b,function(a){c+=
+a});a=a>c?a:c});return a},normalizeDims:function(){var a=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){a++});var b=this.getMaxValue()||1,c=this.config,d=c.animate,e=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(a){var h=0,m=[];g.each(a.getData("valueArray"),function(a){h+=+a;m.push(1)});var j=1==m.length&&!c.updateHeights;d?(a.setData("dimArray",g.map(a.getData("valueArray"),function(a){return j?e:a*e/b}),"end"),a.getData("dimArray")||a.setData("dimArray",
m)):a.setData("dimArray",g.map(a.getData("valueArray"),function(a){return j?e:a*e/b}));a.setData("normalizedDim",h/b)})}});y.TM={};y.TM.SliceAndDice=new j({compute:function(a){var b=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(b);var c=this.canvas.getSize(),d=this.config,e=c.width,c=c.height;this.graph.computeLevels(this.root,0,"ignore");b.getPos(a).setc(-e/2,-c/2);b.setData("width",e,a);b.setData("height",c+d.titleHeight,a);this.computePositions(b,
b,this.layout.orientation,a);this.controller.onAfterCompute(b)},computePositions:function(a,b,c,d){var e=0;a.eachSubnode(function(a){e+=a.getData("area",d)});var f=this.config,h=a.getData("width",d),g=Math.max(a.getData("height",d)-f.titleHeight,0);a=a==b?1:b.getData("area",d)/e;var j,l,k,s,p;"h"==c?(c="v",h*=a,j="height",l="y",k="x",s=f.titleHeight,p=0):(c="h",g*=a,j="width",l="x",k="y",s=0,p=f.titleHeight);var r=b.getPos(d);b.setData("width",h,d);b.setData("height",g,d);var t=0,u=this;b.eachSubnode(function(a){var e=
a.getPos(d);e[l]=t+r[l]+s;e[k]=r[k]+p;u.computePositions(b,a,c,d);t+=a.getData(j,d)})}});y.TM.Area={compute:function(a){a=a||"current";var b=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(b);var c=this.config,d=this.canvas.getSize(),e=d.width,d=d.height,f=c.offset,h=e-f,f=d-f;this.graph.computeLevels(this.root,0,"ignore");b.getPos(a).setc(-e/2,-d/2);b.setData("width",e,a);b.setData("height",d,a);this.computePositions(b,{top:-d/2+c.titleHeight,
left:-e/2,width:h,height:f-c.titleHeight},a);this.controller.onAfterCompute(b)},computeDim:function(a,b,c,d,e,f){if(1==a.length+b.length)this.layoutLast(1==a.length?a:b,c,d,f);else if(2<=a.length&&0==b.length&&(b=[a.shift()]),0==a.length)0<b.length&&this.layoutRow(b,c,d,f);else{var h=a[0];e(b,c)>=e([h].concat(b),c)?this.computeDim(a.slice(1),b.concat([h]),c,d,e,f):(b=this.layoutRow(b,c,d,f),this.computeDim(a,[],b.dim,b,e,f))}},worstAspectRatio:function(a,b){if(!a||0==a.length)return Number.MAX_VALUE;
for(var c=0,d=0,e=Number.MAX_VALUE,f=0,h=a.length;f<h;f++)var g=a[f]._area,c=c+g,e=e<g?e:g,d=d>g?d:g;f=b*b;c*=c;return Math.max(f*d/c,c/(f*e))},avgAspectRatio:function(a,b){if(!a||0==a.length)return Number.MAX_VALUE;for(var c=0,d=0,e=a.length;d<e;d++)var f=a[d]._area/b,c=c+(b>f?b/f:f/b);return c/e},layoutLast:function(a,b,c,d){a=a[0];a.getPos(d).setc(c.left,c.top);a.setData("width",c.width,d);a.setData("height",c.height,d)}};y.TM.Squarified=new j({Implements:y.TM.Area,computePositions:function(a,
b,c){var d=this.config,e=Math.max;this.layout.orientation=b.width>=b.height?"h":"v";var f=a.getSubnodes([1,1],"ignore");if(0<f.length){this.processChildrenLayout(a,f,b,c);a=0;for(var h=f.length;a<h;a++){var g=f[a],j=d.offset;b=e(g.getData("height",c)-j-d.titleHeight,0);var j=e(g.getData("width",c)-j,0),l=g.getPos(c);b={width:j,height:b,top:l.y+d.titleHeight,left:l.x};this.computePositions(g,b,c)}}},processChildrenLayout:function(a,b,c,d){a=c.width*c.height;var e,f=b.length,h=0,g=[];for(e=0;e<f;e++)g[e]=
parseFloat(b[e].getData("area",d)),h+=g[e];for(e=0;e<f;e++)b[e]._area=a*g[e]/h;a=this.layout.horizontal()?c.height:c.width;b.sort(function(a,b){var c=b._area-a._area;return c?c:b.id==a.id?0:b.id<a.id?1:-1});e=[b[0]];b=b.slice(1);this.squarify(b,e,a,c,d)},squarify:function(a,b,c,d,e){this.computeDim(a,b,c,d,this.worstAspectRatio,e)},layoutRow:function(a,b,c,d){return this.layout.horizontal()?this.layoutV(a,b,c,d):this.layoutH(a,b,c,d)},layoutV:function(a,b,c,d){var e=0;g.each(a,function(a){e+=a._area});
b=e/b;for(var f=0,h=0,m=a.length;h<m;h++){var j=a[h]._area/b,l=a[h];l.getPos(d).setc(c.left,c.top+f);l.setData("width",b,d);l.setData("height",j,d);f+=j}a={height:c.height,width:c.width-b,top:c.top,left:c.left+b};a.dim=Math.min(a.width,a.height);a.dim!=a.height&&this.layout.change();return a},layoutH:function(a,b,c,d){var e=0;g.each(a,function(a){e+=a._area});for(var f=e/b,h=c.top,m=0,j=0,l=a.length;j<l;j++){var k=a[j];b=k._area/f;k.getPos(d).setc(c.left+m,h);k.setData("width",b,d);k.setData("height",
f,d);m+=b}a={height:c.height-f,width:c.width,top:c.top+f,left:c.left};a.dim=Math.min(a.width,a.height);a.dim!=a.width&&this.layout.change();return a}});y.TM.Strip=new j({Implements:y.TM.Area,computePositions:function(a,b,c){var d=a.getSubnodes([1,1],"ignore"),e=this.config,f=Math.max;if(0<d.length){this.processChildrenLayout(a,d,b,c);a=0;for(var h=d.length;a<h;a++){var g=d[a],j=e.offset;b=f(g.getData("height",c)-j-e.titleHeight,0);var j=f(g.getData("width",c)-j,0),l=g.getPos(c);b={width:j,height:b,
top:l.y+e.titleHeight,left:l.x};this.computePositions(g,b,c)}}},processChildrenLayout:function(a,b,c,d){a=c.width*c.height;var e,f=b.length,g=0,j=[];for(e=0;e<f;e++)j[e]=+b[e].getData("area",d),g+=j[e];for(e=0;e<f;e++)b[e]._area=a*j[e]/g;a=this.layout.horizontal()?c.width:c.height;e=[b[0]];b=b.slice(1);this.stripify(b,e,a,c,d)},stripify:function(a,b,c,d,e){this.computeDim(a,b,c,d,this.avgAspectRatio,e)},layoutRow:function(a,b,c,d){return this.layout.horizontal()?this.layoutH(a,b,c,d):this.layoutV(a,
b,c,d)},layoutV:function(a,b,c,d){var e=0;g.each(a,function(a){e+=a._area});for(var f=e/b,h=0,j=0,n=a.length;j<n;j++){var l=a[j],k=l._area/f;l.getPos(d).setc(c.left,c.top+(b-k-h));l.setData("width",f,d);l.setData("height",k,d);h+=k}return{height:c.height,width:c.width-f,top:c.top,left:c.left+f,dim:b}},layoutH:function(a,b,c,d){var e=0;g.each(a,function(a){e+=a._area});for(var f=e/b,h=c.height-f,j=0,n=0,l=a.length;n<l;n++){var k=a[n],s=k._area/f;k.getPos(d).setc(c.left+j,c.top+h);k.setData("width",
s,d);k.setData("height",f,d);j+=s}return{height:c.height-f,width:c.width,top:c.top,left:c.left,dim:b}}});y.Icicle=new j({compute:function(a){a=a||"current";var b=this.graph.getNode(this.root),c=this.config,d=this.canvas.getSize(),e=d.width,d=d.height,c=c.constrained?c.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(b);k.Util.computeLevels(this.graph,b.id,0,"ignore");var f=0;k.Util.eachLevel(b,0,!1,function(a,b){b>f&&(f=b)});var b=this.graph.getNode(this.clickedNode&&this.clickedNode.id||
b.id),c=Math.min(f,c-1),g=b._depth;this.layout.horizontal()?this.computeSubtree(b,-e/2,-d/2,e/(c+1),d,g,c,a):this.computeSubtree(b,-e/2,-d/2,e,d/(c+1),g,c,a)},computeSubtree:function(a,b,c,d,e,f,h,j){a.getPos(j).setc(b,c);a.setData("width",d,j);a.setData("height",e,j);var n=0,l=k.Util.getSubnodes(a,[1,1],"ignore");if(l.length){g.each(l,function(a){n+=a.getData("dim")});for(var q=0,s=l.length;q<s;q++)this.layout.horizontal()?(a=e*l[q].getData("dim")/n,this.computeSubtree(l[q],b+d,c,d,a,f,h,j),c+=a):
(a=d*l[q].getData("dim")/n,this.computeSubtree(l[q],b,c+e,a,e,f,h,j),b+=a)}}});$jit.Icicle=new j({Implements:[x,H,y.Icicle],layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(a){var b={animate:!1,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:!1,Node:{type:"rectangle",overridable:!0},Edge:{type:"none"},Label:{type:"Native"},duration:700,
fps:45},c=v("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=g.merge(c,b,a);this.layout.orientation=this.config.orientation;a=this.config;a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(this.canvas=new G(this,a),this.config.labelContainer=("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:z,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new k(this.graphOptions,
this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){if("Native"!=this.config.Label.type){var a=this;this.graph.eachNode(function(b){a.labels.hideLabel(b,!1)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(a){if(!this.busy){this.busy=
!0;var b=this,c=this.config,d={onComplete:function(){c.request&&b.compute();c.animate?(b.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]}),k.Util.eachSubgraph(a,function(a){a.setData("alpha",1,"end")},"ignore"),b.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){b.clickedNode=a;b.compute("end");b.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){b.busy=!1;b.clickedNode=a}})}})):(b.clickedNode=a,b.busy=!1,b.refresh())}};
if(c.request)this.requestNodes(clickedNode,d);else d.onComplete()}},out:function(){if(!this.busy){var a=this,b=k.Util,c=this.config,d=this.graph,e=b.getParents(d.getNode(this.clickedNode&&this.clickedNode.id||this.root))[0],f=this.clickedNode;this.busy=!0;this.events.hoveredNode=!1;if(e)if(callback={onComplete:function(){a.clickedNode=e;c.request?a.requestNodes(e,{onComplete:function(){a.compute();a.plot();a.busy=!1}}):(a.compute(),a.plot(),a.busy=!1)}},c.animate)this.clickedNode=e,this.compute("end"),
this.clickedNode=f,this.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){a.clickedNode=e;d.nodeList.setDataset(["current","end"],{alpha:[0,1]});b.eachSubgraph(f,function(a){a.setData("alpha",1)},"ignore");a.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}});else callback.onComplete();else this.busy=!1}},requestNodes:function(a,b){var c=g.merge(this.controller,b),d=this.config.constrained?this.config.levelsToShow:
Number.MAX_VALUE;if(c.request){var e=[],f=a._depth;k.Util.eachLevel(a,0,d,function(a){a.drawn&&!k.Util.anySubnode(a)&&(e.push(a),a._level=a._depth-f,this.config.constrained&&(a._level=d-a._level))});this.group.requestNodes(e,c)}else c.onComplete()}});$jit.Icicle.Op=new j({Implements:k.Op});$jit.Icicle.Group=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config},requestNodes:function(a,b){var c=0,d=a.length,e=this.viz;if(0==d)b.onComplete();for(var f=0;f<d;f++)b.request(a[f].id,
a[f]._level,{onComplete:function(a,f){f&&f.children&&(f.id=a,e.op.sum(f,{type:"nothing"}));++c==d&&(k.Util.computeLevels(e.graph,e.root,0),b.onComplete())}})}});$jit.Icicle.Plot=new j({Implements:k.Plot,plot:function(a,b){a=a||this.viz.controller;var c=this.viz,d=c.graph.getNode(c.clickedNode&&c.clickedNode.id||c.root),e=d._depth;c.canvas.clear();this.plotTree(d,g.merge(a,{withLabels:!0,hideLabels:!1,plotSubtree:function(a,b){return!c.config.constrained||b._depth-e<c.config.levelsToShow}}),b)}});
$jit.Icicle.Label={};$jit.Icicle.Label.Native=new j({Implements:k.Label.Native,renderLabel:function(a,b){var c=a.getCtx(),d=b.getData("width"),e=b.getData("height"),f=b.getLabelData("size"),g=c.measureText(b.name);e<1.5*f||d<g.width||(f=b.pos.getc(!0),c.fillText(b.name,f.x+d/2,f.y+e/2))}});$jit.Icicle.Label.SVG=new j({Implements:k.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas.getSize(),f=Math.round(d.x+e.width/2),d=Math.round(d.y+e.height/
2);a.setAttribute("x",f);a.setAttribute("y",d);c.onPlaceLabel(a,b)}});$jit.Icicle.Label.HTML=new j({Implements:k.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas.getSize(),f=Math.round(d.x+e.width/2),d=Math.round(d.y+e.height/2),e=a.style;e.left=f+"px";e.top=d+"px";e.display="";c.onPlaceLabel(a,b)}});$jit.Icicle.Plot.NodeTypes=new j({none:{render:g.empty},rectangle:{render:function(a,b){var c=this.viz.config,d=c.offset,e=a.getData("width"),
f=a.getData("height"),h=a.getData("border"),j=a.pos.getc(!0),k=j.x+d/2,l=j.y+d/2,q=b.getCtx();if(!(2>e-d||2>f-d)){if(c.cushion){var c=a.getData("color"),s=q.createRadialGradient(k+(e-d)/2,l+(f-d)/2,1,k+(e-d)/2,l+(f-d)/2,e<f?f:e),p=g.rgbToHex(g.map(g.hexToRgb(c),function(a){return 0.3*a>>0}));s.addColorStop(0,c);s.addColorStop(1,p);q.fillStyle=s}h&&(q.strokeStyle=h,q.lineWidth=3);q.fillRect(k,l,Math.max(0,e-d),Math.max(0,f-d));h&&q.strokeRect(j.x,j.y,e,f)}},contains:function(a,b){if(this.viz.clickedNode&&
!$jit.Graph.Util.isDescendantOf(a,this.viz.clickedNode.id))return!1;var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains({x:c.x+d/2,y:c.y+e/2},b,d,e)}}});$jit.Icicle.Plot.EdgeTypes=new j({none:g.empty});y.ForceDirected=new j({getOptions:function(){var a=this.canvas.getSize(),b=a.width,a=a.height,c=0;this.graph.eachNode(function(){c++});var d=b*a/c,e=Math.sqrt(d),f=this.config.levelDistance;return{width:b,height:a,tstart:0.1*b,nodef:function(a){return d/
(a||1)},edgef:function(a){return e*(a-f)}}},compute:function(a,b){var c=g.splat(a||["current","start","end"]),d=this.getOptions();X.compute(this.graph,c,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(a){g.each(c,function(b){b=a.getPos(b);b.equals(z.KER)&&(b.x=d.width/5*(Math.random()-0.5),b.y=d.height/5*(Math.random()-0.5));a.disp={};g.each(c,function(b){a.disp[b]=J(0,0)})})});this.computePositions(c,d,b)},computePositions:function(a,b,c){var d=this.config.iterations,
e=0,f=this;if(c)(function m(){for(var g=c.iter,j=0;j<g;j++)if(b.t=b.tstart,d&&(b.t*=1-e++/(d-1)),f.computePositionStep(a,b),d&&e>=d){c.onComplete();return}c.onStep(Math.round(100*(e/(d-1))));setTimeout(m,1)})();else for(;e<d;e++)b.t=b.tstart*(1-e/(d-1)),this.computePositionStep(a,b)},computePositionStep:function(a,b){var c=this.graph,d=Math.min,e=Math.max,f=J(0,0);c.eachNode(function(d){g.each(a,function(a){d.disp[a].x=0;d.disp[a].y=0});c.eachNode(function(c){c.id!=d.id&&g.each(a,function(a){var e=
d.getPos(a),g=c.getPos(a);f.x=e.x-g.x;f.y=e.y-g.y;e=f.norm()||1;d.disp[a].$add(f.$scale(b.nodef(e)/e))})})});var h=!!c.getNode(this.root).visited;c.eachNode(function(c){c.eachAdjacency(function(d){var e=d.nodeTo;!!e.visited===h&&g.each(a,function(a){var d=c.getPos(a),g=e.getPos(a);f.x=d.x-g.x;f.y=d.y-g.y;d=f.norm()||1;c.disp[a].$add(f.$scale(-b.edgef(d)/d));e.disp[a].$add(f.$scale(-1))})});c.visited=!h});var j=b.t,k=b.width/2,l=b.height/2;c.eachNode(function(b){g.each(a,function(a){var c=b.disp[a],
f=c.norm()||1;a=b.getPos(a);a.$add(J(c.x*d(Math.abs(c.x),j)/f,c.y*d(Math.abs(c.y),j)/f));a.x=d(k,e(-k,a.x));a.y=d(l,e(-l,a.y))})})}});$jit.ForceDirected=new j({Implements:[x,H,y.ForceDirected],initialize:function(a){var b=$jit.ForceDirected;a=this.controller=this.config=g.merge(v("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{iterations:50,levelDistance:50},a);a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(a.background&&
(a.background=g.merge({type:"Circles"},a.background)),this.canvas=new G(this,a),this.config.labelContainer=("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:z,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new k(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new b.Label[a.Label.type](this);this.fx=new b.Plot(this,b);this.op=new b.Op(this);this.json=null;this.busy=!1;this.initializeExtras()},refresh:function(){this.compute();this.plot()},
reposition:function(){this.compute("end")},computeIncremental:function(a){a=g.merge({iter:20,property:"end",onStep:g.empty,onComplete:g.empty},a||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(a.property,a)},plot:function(){this.fx.plot()},animate:function(a){this.fx.animate(g.merge({modes:["linear"]},a||{}))}});$jit.ForceDirected.$extend=!0;r=$jit.ForceDirected;r.Op=new j({Implements:k.Op});r.Plot=new j({Implements:k.Plot});r.Label={};r.Label.Native=new j({Implements:k.Label.Native});
r.Label.SVG=new j({Implements:k.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,e=e.getSize(),f=Math.round(d.x*j+f+e.width/2),d=Math.round(d.y*k+g+e.height/2);a.setAttribute("x",f);a.setAttribute("y",d);c.onPlaceLabel(a,b)}});r.Label.HTML=new j({Implements:k.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,
f=e.translateOffsetX,g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,l=e.getSize(),d={x:Math.round(d.x*j+f+l.width/2),y:Math.round(d.y*k+g+l.height/2)},f=a.style;f.left=d.x+"px";f.top=d.y+"px";f.display=this.fitsInCanvas(d,e)?"":"none";c.onPlaceLabel(a,b)}});r.Plot.NodeTypes=new j({none:{render:g.empty,contains:g.lambda(!1)},circle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.circle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");
return this.nodeHelper.circle.contains(c,b,d)}},ellipse:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.ellipse.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.ellipse.contains(c,b,d,e)}},square:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.square.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");
return this.nodeHelper.square.contains(c,b,d)}},rectangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.rectangle.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains(c,b,d,e)}},triangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.triangle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");
return this.nodeHelper.triangle.contains(c,b,d)}},star:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.star.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.star.contains(c,b,d)}}});r.Plot.EdgeTypes=new j({none:g.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);this.edgeHelper.line.render(c,d,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);
return this.edgeHelper.line.contains(c,d,b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.getData("dim"),f=a.data.$direction;this.edgeHelper.arrow.render(c,d,e,f&&1<f.length&&f[0]!=a.nodeFrom.id,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(c,d,b,this.edge.epsilon)}}});$jit.TM={};var t=$jit.TM;$jit.TM.$extend=!0;t.Base={layout:{orientation:"h",vertical:function(){return"v"==
this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(a){this.controller=this.config=g.merge(v("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{orientation:"h",titleHeight:13,offset:2,levelsToShow:0,constrained:!1,animate:!1,Node:{type:"rectangle",overridable:!0,width:3,height:3,color:"#444"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,
fps:45},a);this.layout.orientation=this.config.orientation;a=this.config;a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(a.background&&(a.background=g.merge({type:"Circles"},a.background)),this.canvas=new G(this,a),this.config.labelContainer=("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:z,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new k(this.graphOptions,this.config.Node,this.config.Edge);this.labels=
new t.Label[a.Label.type](this);this.fx=new t.Plot(this);this.op=new t.Op(this);this.group=new t.Group(this);this.geom=new t.Geom(this);this.clickedNode=null;this.busy=!1;this.initializeExtras()},refresh:function(){if(!this.busy){this.busy=!0;var a=this;this.config.animate?(this.compute("end"),0<this.config.levelsToShow&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.fx.animate(g.merge(this.config,{modes:["linear","node-property:width:height"],
onComplete:function(){a.busy=!1}}))):("Native"!=this.config.Label.type&&(a=this,this.graph.eachNode(function(b){a.labels.hideLabel(b,!1)})),this.busy=!1,this.compute(),0<this.config.levelsToShow&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.plot())}},plot:function(){this.fx.plot()},leaf:function(a){return 0==a.getSubnodes([1,1],"ignore").length},enter:function(a){if(!this.busy){this.busy=!0;var b=this,c=this.config,d=this.graph,e=this.clickedNode,
f={onComplete:function(){0<c.levelsToShow&&b.geom.setRightLevelToShow(a);(0<c.levelsToShow||c.request)&&b.compute();c.animate?(d.nodeList.setData("alpha",0,"end"),a.eachSubgraph(function(a){a.setData("alpha",1,"end")},"ignore"),b.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){b.clickedNode=a;b.compute("end");b.clickedNode=e;b.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){b.busy=!1;b.clickedNode=a}})}})):(b.busy=!1,b.clickedNode=
a,b.refresh())}};if(c.request)this.requestNodes(a,f);else f.onComplete()}},out:function(){if(!this.busy){this.busy=!0;this.events.hoveredNode=!1;var a=this,b=this.config,c=this.graph,d=c.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents()[0],e=this.clickedNode;if(d)if(callback={onComplete:function(){a.clickedNode=d;b.request?a.requestNodes(d,{onComplete:function(){a.compute();a.plot();a.busy=!1}}):(a.compute(),a.plot(),a.busy=!1)}},0<b.levelsToShow&&this.geom.setRightLevelToShow(d),
b.animate)this.clickedNode=d,this.compute("end"),this.clickedNode=e,this.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){a.clickedNode=d;c.eachNode(function(a){a.setDataset(["current","end"],{alpha:[0,1]})},"ignore");e.eachSubgraph(function(a){a.setData("alpha",1)},"ignore");a.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}});else callback.onComplete();else this.busy=!1}},requestNodes:function(a,b){var c=
g.merge(this.controller,b),d=this.config.levelsToShow;if(c.request){var e=[],f=a._depth;a.eachLevel(0,d,function(a){var b=d-(a._depth-f);a.drawn&&(!a.anySubnode()&&0<b)&&(e.push(a),a._level=b)});this.group.requestNodes(e,c)}else c.onComplete()},reposition:function(){this.compute("end")}};t.Op=new j({Implements:k.Op,initialize:function(a){this.viz=a}});t.Geom=new j({Implements:k.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(a){var b=this.getRightLevelToShow(),
c=this.viz.labels;a.eachLevel(0,b+1,function(d){d._depth-a._depth>b?(d.drawn=!1,d.exist=!1,d.ignore=!0,c.hideLabel(d,!1)):(d.drawn=!0,d.exist=!0,delete d.ignore)});a.drawn=!0;delete a.ignore}});t.Group=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config},requestNodes:function(a,b){var c=0,d=a.length,e=this.viz;if(0==d)b.onComplete();for(var f=0;f<d;f++)b.request(a[f].id,a[f]._level,{onComplete:function(a,f){f&&f.children&&(f.id=a,e.op.sum(f,{type:"nothing"}));++c==d&&
(e.graph.computeLevels(e.root,0),b.onComplete())}})}});t.Plot=new j({Implements:k.Plot,initialize:function(a){this.viz=a;this.config=a.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new P;this.nodeTypes=new t.Plot.NodeTypes;this.edgeTypes=new t.Plot.EdgeTypes;this.labels=a.labels},plot:function(a,b){var c=this.viz,d=c.graph;c.canvas.clear();this.plotTree(d.getNode(c.clickedNode&&c.clickedNode.id||c.root),g.merge(c.config,a||{},{withLabels:!0,hideLabels:!1,plotSubtree:function(a){return a.anySubnode("exist")}}),
b)}});t.Label={};t.Label.Native=new j({Implements:k.Label.Native,initialize:function(a){this.config=a.config;this.leaf=a.leaf},renderLabel:function(a,b){if(this.leaf(b)||this.config.titleHeight){var c=b.pos.getc(!0),d=a.getCtx(),e=b.getData("width");b.getData("height");d.fillText(b.name,c.x+e/2,c.y,e)}}});t.Label.SVG=new j({Implements:k.Label.SVG,initialize:function(a){this.viz=a;this.leaf=a.leaf;this.config=a.config},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,
g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,e=e.getSize(),f=Math.round(d.x*j+f+e.width/2),d=Math.round(d.y*k+g+e.height/2);a.setAttribute("x",f);a.setAttribute("y",d);!this.leaf(b)&&!this.config.titleHeight&&(a.style.display="none");c.onPlaceLabel(a,b)}});t.Label.HTML=new j({Implements:k.Label.HTML,initialize:function(a){this.viz=a;this.leaf=a.leaf;this.config=a.config},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,j=e.scaleOffsetX,
k=e.scaleOffsetY,e=e.getSize(),f=Math.round(d.x*j+f+e.width/2),d=Math.round(d.y*k+g+e.height/2),g=a.style;g.left=f+"px";g.top=d+"px";g.width=b.getData("width")*j+"px";g.height=b.getData("height")*k+"px";g.zIndex=100*b._depth;g.display="";!this.leaf(b)&&!this.config.titleHeight&&(a.style.display="none");c.onPlaceLabel(a,b)}});t.Plot.NodeTypes=new j({none:{render:g.empty},rectangle:{render:function(a,b){var c=this.viz.leaf(a),d=this.config,e=d.offset,f=d.titleHeight,h=a.pos.getc(!0),j=a.getData("width"),
k=a.getData("height"),l=a.getData("border"),q=b.getCtx(),r=h.x+e/2,p=h.y+e/2;j<=e||k<=e||(c?(d.cushion&&(c=q.createRadialGradient(r+(j-e)/2,p+(k-e)/2,1,r+(j-e)/2,p+(k-e)/2,j<k?k:j),d=a.getData("color"),f=g.rgbToHex(g.map(g.hexToRgb(d),function(a){return 0.2*a>>0})),c.addColorStop(0,d),c.addColorStop(1,f),q.fillStyle=c),q.fillRect(r,p,j-e,k-e),l&&(q.save(),q.strokeStyle=l,q.strokeRect(r,p,j-e,k-e),q.restore())):0<f&&(q.fillRect(h.x+e/2,h.y+e/2,j-e,f-e),l&&(q.save(),q.strokeStyle=l,q.strokeRect(h.x+
e/2,h.y+e/2,j-e,k-e),q.restore())))},contains:function(a,b){if(this.viz.clickedNode&&!a.isDescendantOf(this.viz.clickedNode.id)||a.ignore)return!1;var c=a.pos.getc(!0),d=a.getData("width"),e=this.viz.leaf(a)?a.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:c.x+d/2,y:c.y+e/2},b,d,e)}}});t.Plot.EdgeTypes=new j({none:g.empty});t.SliceAndDice=new j({Implements:[x,H,t.Base,y.TM.SliceAndDice]});t.Squarified=new j({Implements:[x,H,t.Base,y.TM.Squarified]});t.Strip=
new j({Implements:[x,H,t.Base,y.TM.Strip]});$jit.RGraph=new j({Implements:[x,H,y.Radial],initialize:function(a){var b=$jit.RGraph;a=this.controller=this.config=g.merge(v("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{interpolation:"linear",levelDistance:100},a);a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(a.background&&(a.background=g.merge({type:"Circles"},a.background)),this.canvas=new G(this,a),this.config.labelContainer=
("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:E,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new k(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new b.Label[a.Label.type](this);this.fx=new b.Plot(this,b);this.op=new b.Op(this);this.root=this.json=null;this.parent=this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;return function(b){return(b._depth+1)*a}},refresh:function(){this.compute();
this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(a){var b=!1,c=this.graph.getNode(a);a=c.getParents();if(a=0<a.length?a[0]:!1)b=a.pos.getc(),c=c.pos.getc(),b=b.add(c.scale(-1)),b=Math.atan2(b.y,b.x),0>b&&(b+=2*Math.PI);return{parent:a,theta:b}},tagChildren:function(a,b){if(a.angleSpan){var c=[];a.eachAdjacency(function(a){c.push(a.nodeTo)},"ignore");for(var d=c.length,e=0;e<d&&b!=c[e].id;e++);for(var e=(e+1)%d,f=0;b!=c[e].id;e=
(e+1)%d)c[e].dist=f++}},onClick:function(a,b){if(this.root!=a&&!this.busy){this.busy=!0;this.root=a;var c=this;this.controller.onBeforeCompute(this.graph.getNode(a));var d=this.getNodeAndParentAngle(a);this.tagChildren(d.parent,a);this.parent=d.parent;this.compute("end");var e=d.theta-d.parent.endPos.theta;this.graph.eachNode(function(a){a.endPos.set(a.endPos.getp().add(new E(e,0)))});d=this.config.interpolation;b=g.merge({onComplete:g.empty},b||{});this.fx.animate(g.merge({hideLabels:!0,modes:[d]},
b,{onComplete:function(){c.busy=!1;b.onComplete()}}))}}});$jit.RGraph.$extend=!0;r=$jit.RGraph;r.Op=new j({Implements:k.Op});r.Plot=new j({Implements:k.Plot});r.Label={};r.Label.Native=new j({Implements:k.Label.Native});r.Label.SVG=new j({Implements:k.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,e=e.getSize(),f=Math.round(d.x*j+f+e.width/2),d=Math.round(d.y*
k+g+e.height/2);a.setAttribute("x",f);a.setAttribute("y",d);c.onPlaceLabel(a,b)}});r.Label.HTML=new j({Implements:k.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,l=e.getSize(),d={x:Math.round(d.x*j+f+l.width/2),y:Math.round(d.y*k+g+l.height/2)},f=a.style;f.left=d.x+"px";f.top=d.y+"px";f.display=this.fitsInCanvas(d,e)?"":"none";c.onPlaceLabel(a,b)}});r.Plot.NodeTypes=
new j({none:{render:g.empty,contains:g.lambda(!1)},circle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.circle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.circle.contains(c,b,d)}},ellipse:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.ellipse.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");
return this.nodeHelper.ellipse.contains(c,b,d,e)}},square:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.square.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.square.contains(c,b,d)}},rectangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");this.nodeHelper.rectangle.render("fill",c,d,e,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("width"),e=a.getData("height");
return this.nodeHelper.rectangle.contains(c,b,d,e)}},triangle:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.triangle.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.triangle.contains(c,b,d)}},star:{render:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");this.nodeHelper.star.render("fill",c,d,b)},contains:function(a,b){var c=a.pos.getc(!0),d=a.getData("dim");return this.nodeHelper.star.contains(c,b,d)}}});
r.Plot.EdgeTypes=new j({none:g.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);this.edgeHelper.line.render(c,d,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(c,d,b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.getData("dim"),f=a.data.$direction;this.edgeHelper.arrow.render(c,d,e,f&&1<f.length&&f[0]!=a.nodeFrom.id,b)},contains:function(a,
b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(c,d,b,this.edge.epsilon)}}});z.prototype.moebiusTransformation=function(a){var b=this.add(a);a=a.$conjugate().$prod(this);a.x++;return b.$div(a)};k.Util.moebiusTransformation=function(a,b,c,d,e){this.eachNode(a,function(a){for(var e=0;e<c.length;e++){var g=b[e].scale(-1),j=d?d:c[e];a.getPos(c[e]).set(a.getPos(j).getc().moebiusTransformation(g))}},e)};$jit.Hypertree=new j({Implements:[x,H,y.Radial],initialize:function(a){var b=
$jit.Hypertree;a=this.controller=this.config=g.merge(v("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35},a);a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(a.background&&(a.background=g.merge({type:"Circles"},a.background)),this.canvas=new G(this,a),this.config.labelContainer=("string"==typeof a.injectInto?a.injectInto:a.injectInto.id)+"-label");
this.graphOptions={klass:E,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new k(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new b.Label[a.Label.type](this);this.fx=new b.Plot(this,b);this.op=new b.Op(this);this.root=this.json=null;this.busy=!1;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.getRadius(),b=0,c=Math.max,d=this.config;this.graph.eachNode(function(a){b=c(a._depth,b)},"ignore");b++;for(var e=function(b){return function(c){c.scale=a;c=c._depth+
1;for(var e=0,f=Math.pow;c;)e+=f(b,c--);return e-d.offset}},f=0.51;1>=f;f+=0.01)if(2<=(1-Math.pow(f,b))/(1-f))return e(f-0.01);return e(0.75)},getRadius:function(){var a=this.config.radius;if("auto"!==a)return a;a=this.canvas.getSize();return Math.min(a.width,a.height)/2},refresh:function(a){a?(this.reposition(),this.graph.eachNode(function(a){a.startPos.rho=a.pos.rho=a.endPos.rho;a.startPos.theta=a.pos.theta=a.endPos.theta})):this.compute();this.plot()},reposition:function(){this.compute("end");
var a=this.graph.getNode(this.root).pos.getc().scale(-1);k.Util.moebiusTransformation(this.graph,[a],["end"],"end","ignore");this.graph.eachNode(function(a){a.ignore&&(a.endPos.rho=a.pos.rho,a.endPos.theta=a.pos.theta)})},plot:function(){this.fx.plot()},onClick:function(a,b){var c=this.graph.getNode(a).pos.getc(!0);this.move(c,b)},move:function(a,b){var c=J(a.x,a.y);if(!1===this.busy&&1>c.norm()){this.busy=!0;var d=this.graph.getClosestNodeToPos(c),e=this;this.graph.computeLevels(d.id,0);this.controller.onBeforeCompute(d);
b=g.merge({onComplete:g.empty},b||{});this.fx.animate(g.merge({modes:["moebius"],hideLabels:!0},b,{onComplete:function(){e.busy=!1;b.onComplete()}}),c)}}});$jit.Hypertree.$extend=!0;x=$jit.Hypertree;x.Op=new j({Implements:k.Op});x.Plot=new j({Implements:k.Plot});x.Label={};x.Label.Native=new j({Implements:k.Label.Native,initialize:function(a){this.viz=a},renderLabel:function(a,b){var c=a.getCtx(),d=b.pos.getc(!0),e=this.viz.getRadius();c.fillText(b.name,d.x*e,d.y*e)}});x.Label.SVG=new j({Implements:k.Label.SVG,
initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,e=e.getSize(),l=this.viz.getRadius(),f=Math.round(d.x*j*l+f+e.width/2),d=Math.round(d.y*k*l+g+e.height/2);a.setAttribute("x",f);a.setAttribute("y",d);c.onPlaceLabel(a,b)}});x.Label.HTML=new j({Implements:k.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,c){var d=b.pos.getc(!0),e=this.viz.canvas,f=e.translateOffsetX,
g=e.translateOffsetY,j=e.scaleOffsetX,k=e.scaleOffsetY,l=e.getSize(),q=this.viz.getRadius(),d={x:Math.round(d.x*j*q+f+l.width/2),y:Math.round(d.y*k*q+g+l.height/2)},f=a.style;f.left=d.x+"px";f.top=d.y+"px";f.display=this.fitsInCanvas(d,e)?"":"none";c.onPlaceLabel(a,b)}});x.Plot.NodeTypes=new j({none:{render:g.empty,contains:g.lambda(!1)},circle:{render:function(a,b){var c=this.node,d=a.getData("dim"),e=a.pos.getc(),d=c.transform?d*(1-e.squaredNorm()):d;e.$scale(a.scale);0.2<d&&this.nodeHelper.circle.render("fill",
e,d,b)},contains:function(a,b){var c=a.getData("dim"),d=a.pos.getc().$scale(a.scale);return this.nodeHelper.circle.contains(d,b,c)}},ellipse:{render:function(a,b){var c=a.pos.getc().$scale(a.scale),d=a.getData("width"),e=a.getData("height");this.nodeHelper.ellipse.render("fill",c,d,e,b)},contains:function(a,b){var c=a.getData("width"),d=a.getData("height"),e=a.pos.getc().$scale(a.scale);return this.nodeHelper.circle.contains(e,b,c,d)}},square:{render:function(a,b){var c=this.node,d=a.getData("dim"),
e=a.pos.getc(),d=c.transform?d*(1-e.squaredNorm()):d;e.$scale(a.scale);0.2<d&&this.nodeHelper.square.render("fill",e,d,b)},contains:function(a,b){var c=a.getData("dim"),d=a.pos.getc().$scale(a.scale);return this.nodeHelper.square.contains(d,b,c)}},rectangle:{render:function(a,b){var c=this.node,d=a.getData("width"),e=a.getData("height"),f=a.pos.getc(),d=c.transform?d*(1-f.squaredNorm()):d,e=c.transform?e*(1-f.squaredNorm()):e;f.$scale(a.scale);0.2<d&&0.2<e&&this.nodeHelper.rectangle.render("fill",
f,d,e,b)},contains:function(a,b){var c=a.getData("width"),d=a.getData("height"),e=a.pos.getc().$scale(a.scale);return this.nodeHelper.rectangle.contains(e,b,c,d)}},triangle:{render:function(a,b){var c=this.node,d=a.getData("dim"),e=a.pos.getc(),d=c.transform?d*(1-e.squaredNorm()):d;e.$scale(a.scale);0.2<d&&this.nodeHelper.triangle.render("fill",e,d,b)},contains:function(a,b){var c=a.getData("dim"),d=a.pos.getc().$scale(a.scale);return this.nodeHelper.triangle.contains(d,b,c)}},star:{render:function(a,
b){var c=this.node,d=a.getData("dim"),e=a.pos.getc(),d=c.transform?d*(1-e.squaredNorm()):d;e.$scale(a.scale);0.2<d&&this.nodeHelper.star.render("fill",e,d,b)},contains:function(a,b){var c=a.getData("dim"),d=a.pos.getc().$scale(a.scale);return this.nodeHelper.star.contains(d,b,c)}}});x.Plot.EdgeTypes=new j({none:g.empty,line:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.nodeFrom.scale;this.edgeHelper.line.render({x:c.x*e,y:c.y*e},{x:d.x*e,y:d.y*e},b)},contains:function(a,
b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.nodeFrom.scale;this.edgeHelper.line.contains({x:c.x*e,y:c.y*e},{x:d.x*e,y:d.y*e},b,this.edge.epsilon)}},arrow:{render:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.nodeFrom.scale,f=a.getData("dim"),g=a.data.$direction;this.edgeHelper.arrow.render({x:c.x*e,y:c.y*e},{x:d.x*e,y:d.y*e},f,g&&1<g.length&&g[0]!=a.nodeFrom.id,b)},contains:function(a,b){var c=a.nodeFrom.pos.getc(!0),d=a.nodeTo.pos.getc(!0),e=a.nodeFrom.scale;
this.edgeHelper.arrow.contains({x:c.x*e,y:c.y*e},{x:d.x*e,y:d.y*e},b,this.edge.epsilon)}},hyperline:{render:function(a,b){var c=a.nodeFrom.pos.getc(),d=a.nodeTo.pos.getc(),e=this.viz.getRadius();this.edgeHelper.hyperline.render(c,d,e,b)},contains:g.lambda(!1)}})})();